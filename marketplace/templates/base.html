{% load static i18n %}
<!DOCTYPE html>
<html lang="{{ LANGUAGE_CODE }}" dir="{% if LANGUAGE_CODE == 'ar' %}rtl{% else %}ltr{% endif %}">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>{% block title %}Site{% endblock %}</title>
    <link rel="stylesheet" href="{% static 'css/style.css' %}">
  {% block head %}{% endblock %}
</head>
<body>

<header style="padding:10px;border-bottom:1px solid #ccc;display:flex;justify-content:space-between;">
  <div>
    <a href="/">{% trans "Home" %}</a>
  </div>

  <div style="display:flex;align-items:center;gap:14px;">


      {% if user.is_authenticated and user.is_staff %}
            <a href="{% url 'admin:index' %}">{% trans "Admin Dashboard" %}</a> |
        {% endif %}

    {% if request.user.is_authenticated %}
      <div class="profile-dropdown" id="profileDropdown">
        <button type="button" class="profile-button" onclick="toggleDropdown()"
                style="background:none;border:0;display:flex;align-items:center;gap:8px;cursor:pointer;">
            <img src="{% static 'img/profile-icon.png' %}" alt="profile icon"
                 style="width:32px;height:32px;border-radius:50%;object-fit:cover;">
            {{ request.user.username }}
        </button>

        <div class="dropdown-menu">
          <a href="{% url 'user_profile' request.user.user_id %}">{% trans "My Profile" %}</a>
          <a href="{% url 'my_items' %}">{% trans "My Items" %}</a>
          <a href="{% url 'user_inbox' %}">{% trans "My Messages" %}</a>
          <a href="{% url 'notifications' %}">{% trans "Notifications" %}</a>
          <a href="{% url 'create_item' %}">{% trans "Post an Ad" %}</a>
          <a href="{% url 'logout' %}" style="color:#dc3545;">{% trans "Logout" %}</a>
        </div>
      </div>
    {% else %}
      <a href="{% url 'login' %}">{% trans "Login" %}</a> |
      <a href="{% url 'register' %}">{% trans "Register" %}</a>
    {% endif %}

    <form action="{% url 'set_language' %}" method="post">
      {% csrf_token %}
      <select name="language" onchange="this.form.submit()">
        <option value="en" {% if LANGUAGE_CODE == 'en' %}selected{% endif %}>English</option>
        <option value="ar" {% if LANGUAGE_CODE == 'ar' %}selected{% endif %}>العربية</option>
      </select>
    </form>

  </div>
</header>

<main>
  {% block content %}{% endblock %}
</main>

<script src="https://unpkg.com/htmx.org@1.9.12">

function toggleDropdown() {
  document.getElementById("profileDropdown").classList.toggle("active");
}
document.addEventListener("click", function(e){
  const dd = document.getElementById("profileDropdown");
  if (dd && !e.target.closest("#profileDropdown")) dd.classList.remove("active");
});
</script>

{% block scripts %}{% endblock %}
</body>
</html>
