{% load static i18n %}
<!doctype html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>{% block title %}ุฑูู โ ููุตุฉ ุฅุนูุงูุงุช{% endblock %}</title>

  <meta name="description" content="ููุตุฉ ุฑูู ููุฅุนูุงูุงุช ุงููุจูุจุฉ - ุจูุนุ ุงุดุชุฑูุ ุฃู ุงุทูุจ ูุง ุชุญุชุงุฌู ุจุณูููุฉ ูุฃูุงู">

  <!-- Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link
    href="https://fonts.googleapis.com/css2?family=Cairo:wght@300;400;600;700;800&display=swap"
    rel="stylesheet">

  <!-- Tailwind (mockup uses it) -->
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- Swiper CSS (for sliders on home page) -->
  <link rel="stylesheet"
        href="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.css" />

  <!-- Mockup CSS -->
  <link rel="stylesheet" href="{% static 'css/header.css' %}">
  <link rel="stylesheet" href="{% static 'css/footer.css' %}">
  <link rel="stylesheet" href="{% static 'css/home.css' %}">
  <!-- Small overrides for search behaviour/dropdown -->
  <link rel="stylesheet" href="{% static 'css/search.css' %}">

  {% block base_css %}{% endblock %}
</head>

<body class="font-[Cairo] bg-white text-gray-900">

<!-- =================== TOPBAR =================== -->
<div class="topbar">
  <div class="container">

    <!-- Logo -->
    <div class="logo-box">
      <a href="{% url 'home' %}">
        <img src="https://i.imgur.com/LNx5828.png" class="logo" alt="ุดุนุงุฑ ุฑูู" />
      </a>
    </div>

    <!-- IF USER NOT LOGGED IN: mockup auth buttons -->
    {% if not request.user.is_authenticated %}
      <div id="authButtons" class="auth-buttons">
        <a href="{% url 'login' %}" id="loginBtn" class="btn-login">
          ุชุณุฌูู ุงูุฏุฎูู
        </a>
        <a href="{% url 'register' %}" class="btn-signup">
          ุฅูุดุงุก ุญุณุงุจ
        </a>
      </div>
    {% else %}
    <!-- IF USER LOGGED IN: your dynamic icons bar (fav/msg/noti/user) -->
      <div id="userIcons" class="user-icons">
        <div class="flex items-center gap-4 text-[var(--muted)]">

          <!-- Favorites -->
          <div class="relative">
            <button id="favBtn"
                    class="relative hover:text-gray-900 transition-colors topbar-icon"
                    aria-expanded="false" aria-haspopup="true" aria-label="ุงูููุถูุฉ">
              โค๏ธ
              {% if favorite_count %}
                <span class="badge">{{ favorite_count }}</span>
              {% endif %}
            </button>
            <div id="favMenu" class="dropdown" aria-labelledby="favBtn">
              <div class="dropdown-header">ุงูููุถูุฉ</div>
              <div class="dropdown-list">
                {% for fav in recent_favorites %}
                  {% with item=fav.item %}
                    <a href="{% url 'item_detail' item.id %}" class="dropdown-item">
                      <div class="w-12 h-12 rounded-md overflow-hidden bg-gray-100 border flex-shrink-0">
                        {% with photo=item.photos.first %}
                          {% if photo %}
                            <img src="{{ photo.image.url }}" alt="{{ item.title }}"
                                 class="w-full h-full object-cover">
                          {% else %}
                            <div class="w-full h-full flex items-center justify-center
                                        text-gray-400 text-xs">๐ผ๏ธ</div>
                          {% endif %}
                        {% endwith %}
                      </div>
                      <div>
                        <div class="font-medium text-gray-900 truncate">{{ item.title }}</div>
                        <div class="text-xs text-[var(--muted)]">{{ item.price }} ุฏ.ุฃ</div>
                      </div>
                    </a>
                  {% endwith %}
                {% empty %}
                  <div class="px-4 py-3 text-sm text-gray-500">
                    ูุง ููุฌุฏ ุนูุงุตุฑ ูู ุงูููุถูุฉ.
                  </div>
                {% endfor %}
              </div>
              <div class="p-3 border-t">
                <a href="{% url 'my_favorites' %}"
                   class="block text-center text-sm text-white rounded-lg py-2 btn-primary">
                  ุนุฑุถ ูู ุงูููุถูุฉ
                </a>
              </div>
            </div>
          </div>

          <!-- Messages -->
          <div class="relative">
            <button id="msgBtn"
                    class="relative hover:text-gray-900 transition-colors topbar-icon"
                    aria-expanded="false" aria-haspopup="true" aria-label="ุงูุฑุณุงุฆู">
              โ๏ธ
              {% if unread_messages %}
                <span class="badge">{{ unread_messages }}</span>
              {% endif %}
            </button>
            <div id="msgMenu" class="dropdown" aria-labelledby="msgBtn">
              <div class="dropdown-header">ุงูุฑุณุงุฆู</div>
              <div class="dropdown-list">
                {% for msg in recent_messages %}
                  <a href="{% url 'chat_room' msg.conversation.id %}"
                     class="dropdown-item {% if not msg.is_read %}bg-orange-50{% endif %}">
                    <div class="flex-shrink-0 w-8 h-8 rounded-full bg-orange-100 text-orange-700
                                flex items-center justify-center text-xs font-semibold">
                      {{ msg.sender.username|first|upper }}
                    </div>
                    <div class="min-w-0">
                      <div class="flex justify-between gap-2">
                        <div class="font-medium text-gray-900 truncate">
                          {{ msg.sender.username }}
                        </div>
                        <div class="text-xs text-[var(--muted)] whitespace-nowrap">
                          {{ msg.created_at|timesince }} {% trans "ago" %}
                        </div>
                      </div>
                      <div class="text-xs text-gray-600 truncate">
                        {% if msg.conversation.item %}
                          {{ msg.conversation.item.title }}
                        {% else %}
                          {% trans "Conversation" %}
                        {% endif %}
                      </div>
                      <div class="text-xs text-gray-500 mt-0.5 line-clamp-2">
                        {{ msg.body }}
                      </div>
                    </div>
                  </a>
                {% empty %}
                  <div class="px-4 py-3 text-sm text-gray-500">
                    ูุง ููุฌุฏ ุฑุณุงุฆู.
                  </div>
                {% endfor %}
              </div>
              <div class="p-3 border-t">
                <a href="{% url 'user_inbox' %}"
                   class="block text-center text-sm text-white rounded-lg py-2 btn-primary">
                  ูุชุญ ุตูุฏูู ุงูุฑุณุงุฆู
                </a>
              </div>
            </div>
          </div>

          <!-- Notifications -->
          <div class="relative">
            <button id="notiBtn"
                    class="relative hover:text-gray-900 transition-colors topbar-icon"
                    aria-expanded="false" aria-haspopup="true" aria-label="ุงูุฅุดุนุงุฑุงุช">
              ๐
              {% if unread_notifications %}
                <span class="badge">{{ unread_notifications }}</span>
              {% endif %}
            </button>
            <div id="notiMenu" class="dropdown" aria-labelledby="notiBtn">
              <div class="dropdown-header">ุงูุฅุดุนุงุฑุงุช</div>
              <div class="dropdown-list">
                {% for n in recent_notifications %}
                  <div class="dropdown-item">
                    <div class="flex-none w-10 h-10 rounded-full bg-green-50 text-green-600
                                flex items-center justify-content-center">โ๏ธ</div>
                    <div>
                      <div class="font-medium text-gray-900">{{ n.title }}</div>
                      <div class="text-xs text-[var(--muted)]">
                        {{ n.created_at|timesince }} {% trans "ago" %}
                      </div>
                    </div>
                  </div>
                {% empty %}
                  <div class="px-4 py-3 text-sm text-gray-500">
                    ูุง ููุฌุฏ ุฅุดุนุงุฑุงุช.
                  </div>
                {% endfor %}
              </div>
              <div class="p-3 border-t">
                <a href="{% url 'notifications' %}"
                   class="block text-center text-sm text-white rounded-lg py-2 btn-primary">
                  ูู ุงูุฅุดุนุงุฑุงุช
                </a>
              </div>
            </div>
          </div>

          <!-- User Menu -->
          <div class="relative">
            <button id="userBtn"
                    class="flex items-center gap-2 transition-colors hover:text-gray-900"
                    aria-expanded="false" aria-haspopup="true" aria-label="ุญุณุงุจ ุงููุณุชุฎุฏู">
              <div class="w-7 h-7 rounded-full bg-gray-200 flex items-center justify-center text-xs font-semibold">
                {{ request.user.username|first|upper }}
              </div>
              <span class="hidden sm:inline-block">
                ูุฑุญุจูุงุ {{ request.user.username }}
              </span>
            </button>
            <div id="userMenu" class="dropdown w-44" aria-labelledby="userBtn">
              <a href="{% url 'user_profile' request.user.user_id %}"
                 class="block px-4 py-2 text-sm hover:bg-[var(--rukn-gray)] transition-colors">
                ูููู ุงูุดุฎุตู
              </a>
              <a href="{% url 'my_items' %}"
                 class="block px-4 py-2 text-sm hover:bg-[var(--rukn-gray)] transition-colors">
                ุฅุนูุงูุงุชู
              </a>
              <a href="#"
                 id="inviteFriendsLink"
                 data-register-url="{% url 'register' %}"
                 data-referral-code="{{ request.user.referral_code|default:'' }}"
                 class="block px-4 py-2 text-sm hover:bg-[var(--rukn-gray)] transition-colors">
                ๐ ุฏุนูุฉ ุงูุฃุตุฏูุงุก
              </a>
              {% if request.user.is_staff %}
                <a href="/admin/"
                   class="block px-4 py-2 text-sm hover:bg-[var(--rukn-gray)] transition-colors">
                  ููุญุฉ ุงูุชุญูู
                </a>
              {% endif %}
              <a href="{% url 'logout' %}"
                 class="block px-4 py-2 text-sm text-red-600 hover:bg-[var(--rukn-gray)] transition-colors">
                ุชุณุฌูู ุงูุฎุฑูุฌ
              </a>
            </div>
          </div>

        </div>
      </div>
    {% endif %}

  </div>
</div>

<!-- ========== LOGIN MODAL (mockup style) ========== -->
{% if not request.user.is_authenticated %}
<div id="loginModal" class="modal hidden">
  <div class="modal-box">

    <span id="closeLoginX" class="modal-close-x">โ</span>

    <div class="login-icon">๐</div>
    <h2 class="modal-title">ุชุณุฌูู ุงูุฏุฎูู</h2>

    <!-- For now: redirect to login page -->
    <form id="loginForm" class="modal-form" action="{% url 'login' %}" method="get">
      <button type="submit" class="modal-submit">
        ุงูุฐูุงุจ ูุตูุญุฉ ุชุณุฌูู ุงูุฏุฎูู
      </button>
    </form>

    <div class="modal-footer-link">
      <a href="{% url 'login' %}">ูุณูุช ูููุฉ ุงููุฑูุฑุ</a>
    </div>

    <div class="modal-footer-link">
      ููุณ ูุฏูู ุญุณุงุจุ
      <a href="{% url 'register' %}">ุฅูุดุงุก ุญุณุงุจ ุฌุฏูุฏ</a>
    </div>

  </div>
</div>
{% endif %}

<!-- =================== HEADER (SEARCH) =================== -->
{% block searchbar %}
<header class="bg-white shadow-sm z-40">
  <div class="max-w-[1500px] mx-auto">
    <div class="flex flex-col md:flex-row items-center justify-between gap-3 py-5 px-8">

      <div class="w-full px-3 mt-2 md:mt-0">
          <form id="siteSearch"
              action="{% url 'item_list' %}"
              method="get"
              class="flex flex-col sm:flex-row items-stretch gap-2 w-full"
              role="search">

          <!-- Search input -->
          <div class="relative flex-1">
            <input id="searchInput"
                   name="q"
                   type="search"
                   autocomplete="off"
                   required
                   placeholder="ุงุจุญุซ ุนู ุฅุนูุงู"
                   class="w-full bg-white text-base md:text-lg rounded-3xl border-2 border-[var(--rukn-orange)]
                          py-2.5 px-4 pr-36 focus:outline-none focus:ring-2 focus:ring-orange-200
                          transition-all duration-300" />

            <div id="intentBox"
                 class="absolute right-2 top-1/2 -translate-y-1/2 flex border border-gray-200 shadow-sm
                        bg-white overflow-hidden rounded-2xl">
              <button id="sellBtn" type="button"
                      class="w-[58px] h-8 text-sm font-extrabold text-white bg-[var(--rukn-orange)]">
                ุงุนูุงู
              </button>
              <button id="buyBtn" type="button"
                      class="w-[58px] h-8 text-sm font-extrabold text-gray-600 bg-white">
                ุทูุจ
              </button>
            </div>


            <!-- Search button -->
            <button id="searchBtn"
                    type="submit"
                    disabled
                    class="absolute left-2 top-1/2 -translate-y-1/2 bg-[var(--rukn-orange)] text-white
                           w-8 h-8 rounded-3xl flex items-center justify-center shadow-md hover:scale-105
                           transition-all duration-300 disabled:opacity-40 disabled:cursor-not-allowed"
                    aria-label="ุงุจุญุซ">
              <svg xmlns="http://www.w3.org/2000/svg" class="w-4 h-4"
                   fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                <path stroke-linecap="round" stroke-linejoin="round"
                      d="M21 21l-4.35-4.35M10.5 18a7.5 7.5 0 1 1 0-15 7.5 7.5 0 0 1 0 15z" />
              </svg>
            </button>

            <!-- Suggestions dropdown (filled by JS) -->
            <div id="searchSuggestionsBox"
                 class="absolute z-40 mt-2 w-full bg-white border border-gray-200 rounded-xl shadow-lg
                        text-sm hidden">
            </div>
          </div>

          <!-- Add Ad button -->
          <a id="addAdBtn"
             href="{% url 'create_item' %}"
             class="text-center text-sm font-extrabold text-white bg-[var(--rukn-orange)]
                    px-4 py-4 rounded-3xl shadow-md hover:shadow-lg transition-all duration-300
                    w-full sm:w-auto">
            ุฃุถู ุฅุนูุงูู
          </a>

          </form>
      </div>

    </div>
  </div>
</header>
{% endblock %}

<!-- =================== MAIN CONTENT =================== -->
<main>
  {% block content %}{% endblock %}
</main>

<!-- =================== FOOTER (mockup) =================== -->
<footer class="footer-bg-custom pt-10 pb-6 mt-10">
  <div class="max-w-7xl mx-auto px-6 grid md:grid-cols-4 gap-10">

    <!-- Logo + description -->
    <div>
      <div class="logo-wrapper mb-4">
        <img src="https://i.imgur.com/Un8z11f.png" alt="ุดุนุงุฑ ุฑูู"
             class="h-7 w-auto object-contain" />
        <span class="text-sm font-semibold tracking-wide">
          ุฑูู โููุตุฉ  ุฅุนูุงูุงุช
        </span>
      </div>
      <p class="text-sm leading-7">
        ููุตุฉ ุจูุน ู ุดุฑุงุก ููุฌููุนุ
        ุงุจุญุซ ุนู ุงูููุชุฌ ุงููุทููุจ ู ุชูุงุตู ูุน ุงูุจุงุฆุนุ
        ูู ุชุฌุฏ ุงูููุชุฌุ ูุง ุชูููุ ุจุฅููุงูู ุชูุฏูู ุทูุจ
        ู ุณูููู ุงูุจุงุฆุนูู ุจุงูุชูุงุตู ูุนู.
      </p>
    </div>

    <!-- Quick links -->
    <div>
      <h4 class="font-semibold mb-3 text-base">ุฑูุงุจุท ุณุฑูุนุฉ</h4>
      <ul class="space-y-2 text-sm">
        <li><a href="{% url 'item_list' %}" class="hover:text-[var(--footer-accent)]">ุชุตูุญ ุงูุฅุนูุงูุงุช</a></li>
        <li><a href="{% url 'contact' %}" class="hover:text-[var(--footer-accent)]">ุงุชุตู ุจูุง</a></li>
      </ul>
    </div>

    <!-- Categories -->
    <div>
      <h4 class="font-semibold mb-3 text-base">ุงูุฃูุณุงู</h4>
      <ul class="space-y-2 text-sm">
        <li><a href="{% url 'category_list' %}" class="hover:text-[var(--footer-accent)]">ูู ุงูุฃูุณุงู</a></li>
      </ul>
    </div>

    <!-- Contact -->
    <div>
      <h4 class="font-semibold mb-3 text-base">ุชูุงุตู ูุนูุง</h4>
      <p class="text-sm mb-3">๐ง info@rokon.example</p>
      <div class="flex gap-4 text-xl">
        <a href="#" aria-label="Facebook" class="hover:text-[var(--footer-accent)]">๐</a>
        <a href="#" aria-label="Twitter" class="hover:text-[var(--footer-accent)]">๐ฆ</a>
        <a href="#" aria-label="Instagram" class="hover:text-[var(--footer-accent)]">๐ธ</a>
      </div>
    </div>

  </div>

  <div class="footer-bottom">
    ุฌููุน ุงูุญููู ูุญููุธุฉ
    <span> ุฑูู </span> ยฉ 2025
  </div>
</footer>

<!-- =================== JS =================== -->

<!-- HTMX (used by your old search) -->
<script src="https://unpkg.com/htmx.org@1.9.10"></script>

<!-- Swiper JS (hero slider, used on home page) -->
<script src="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.js"></script>

{% block scripts %}
  <!-- All navbar + search + categories + referral JS moved here -->
  <script src="{% static 'js/main.js' %}"></script>
  <script src="{% static 'js/swiper-init.js' %}"></script>
  <script src="{% static 'js/search.js' %}"></script>
  <script src="{% static 'js/header.js' %}"></script>

{% endblock %}


</body>
</html>


