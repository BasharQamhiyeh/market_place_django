{% load static i18n %}
<!doctype html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>{% block title %}Ø±ÙƒÙ† â€” Ù…Ù†ØµØ© Ø¥Ø¹Ù„Ø§Ù†Ø§Øª{% endblock %}</title>

  <meta name="description" content="Ù…Ù†ØµØ© Ø±ÙƒÙ† Ù„Ù„Ø¥Ø¹Ù„Ø§Ù†Ø§Øª Ø§Ù„Ù…Ø¨ÙˆØ¨Ø© - Ø¨ÙŠØ¹ØŒ Ø§Ø´ØªØ±ÙŠØŒ Ø£Ùˆ Ø§Ø·Ù„Ø¨ Ù…Ø§ ØªØ­ØªØ§Ø¬Ù‡ Ø¨Ø³Ù‡ÙˆÙ„Ø© ÙˆØ£Ù…Ø§Ù†">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@300;400;600;700;800&display=swap" rel="stylesheet">
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://unpkg.com/htmx.org@1.9.10"></script>
  <script src="https://unpkg.com/htmx.org@1.9.10"></script>

  <style>
  /* ==== Ø®Ù„ÙÙŠØ§Øª Ø¨Ø§Ø±Ø²Ø© ÙˆÙØµÙ„ Ø§Ù„Ø£Ù‚Ø³Ø§Ù… ==== */

  /* Ø¨Ø±ØªÙ‚Ø§Ù„ÙŠ Ù†Ø§Ø¹Ù… Ù„Ù„Ø£Ù‚Ø³Ø§Ù… Ø§Ù„Ø¹Ø§Ù…Ø© */
  .section-box {
    background: linear-gradient(to bottom, #fff, #fff7f1);
    border-radius: 1rem;
    box-shadow: 0 8px 24px rgba(0, 0, 0, 0.04);
    padding: 3rem 1rem;
    margin-top: 3rem;
  }

  /* Ø£Ø®Ø¶Ø± Ù†Ø§Ø¹Ù… Ù„Ù„Ø£Ù‚Ø³Ø§Ù… Ø°Ø§Øª Ø§Ù„Ø«ÙŠÙ… Ø§Ù„Ø£Ø®Ø¶Ø± */
  .section-box-green {
    background: linear-gradient(to bottom, #ecfdf5, #ffffff);
    border-radius: 1rem;
    box-shadow: 0 8px 24px rgba(0, 0, 0, 0.04);
    padding: 3rem 1rem;
    margin-top: 3rem;
  }

  /* ÙØµÙ„ Ù…Ø±Ø¦ÙŠ Ø¥Ø¶Ø§ÙÙŠ Ø¨ÙŠÙ† ÙƒÙ„ Ù‚Ø³Ù… */
  section + section {
    margin-top: 4rem;
    border-top: 1px solid #e5e7eb;
    padding-top: 2rem;
  }

  :root{
    --rukn-orange:#ff7a18;
    --rukn-gray:#f3f4f6;
    --muted:#6b7280;
    --transition:.3s ease;

    /* Ø«ÙŠÙ… Ø£Ø®Ø¶Ø± Ù„Ù„Ø·Ù„Ø¨Ø§Øª */
    --rukn-green:#16a34a;
    --rukn-green-700:#15803d;
    --rukn-green-50:#ecfdf5;
    --rukn-green-100:#d1fae5;
    --rukn-green-200:#a7f3d0;
  }

  body{
    font-family:'Cairo',sans-serif;
    background:#ffffff;
    color:#111827;
    padding-top:40px;
    line-height:1.6;
  }

  .card-shadow,.shadow-card{box-shadow:0 6px 18px rgba(20,20,30,.06)}

  .topbar{
    position:fixed;
    inset-inline:0;
    top:0;
    height:40px;
    background:#ffe8d1;
    z-index:70;
    border-bottom:1px solid #e5e7eb;
    backdrop-filter:blur(8px);
  }

  .dropdown{
    position:absolute;
    top:calc(100% + 8px);
    right:auto;
    left:0;
    width:280px;
    background:#fff;
    border:1px solid #e5e7eb;
    border-radius:12px;
    box-shadow:0 10px 25px rgba(0,0,0,.08);
    display:none;
    z-index:80;
    opacity:0;
    transform:translateY(-10px);
    transition:opacity var(--transition),transform var(--transition)
  }
  .dropdown.show{display:block;opacity:1;transform:translateY(0)}
  .dropdown-header{padding:.75rem 1rem;font-weight:700;border-bottom:1px solid #f1f1f1}
  .dropdown-list{max-height:320px;overflow:auto}
  .dropdown-item{display:flex;gap:.75rem;padding:.75rem 1rem;align-items:flex-start;transition:background var(--transition)}
  .dropdown-item:hover{background:#fafafa}
  .badge{
    position:absolute;
    inset-inline-end:-.25rem;
    inset-block-start:-.25rem;
    background:var(--rukn-orange);
    color:#fff;
    font-size:.7rem;
    border-radius:999px;
    width:1.1rem;
    height:1.1rem;
    display:flex;
    align-items:center;
    justify-content:center;
    font-weight:bold
  }

  .intent-pill span{
    display:inline-block;
    padding:.35rem .9rem;
    border-radius:9999px;
    font-weight:700;
    font-size:.85rem;
    color:#374151;
    transition:all var(--transition);
    cursor:pointer
  }
  .intent-pill input:focus-visible+span{outline:2px solid rgba(255,122,24,.5);outline-offset:2px}
  .intent-pill input:checked+span{background:var(--rukn-orange);color:#fff;box-shadow:0 6px 18px rgba(255,122,24,.25)}
  .intent-pill span:hover{background:#f3f4f6}

  .wiggle{transition:transform .3s ease}.wiggle:hover{transform:scale(1.1)}
  @media(max-width:380px){
    .dropdown{width:calc(100vw - 16px);right:8px}
  }

  @keyframes fadeInUp{
    from{opacity:0;transform:translateY(20px)}
    to{opacity:1;transform:translateY(0)}
  }
  .animate-fade-in{animation:fadeInUp .9s ease forwards}
  .animate-fade-in-delayed{animation:fadeInUp 1.1s ease forwards}
  .animate-fade-in-slow{animation:fadeInUp 1.3s ease forwards}

  .hscroll{
    display:flex;
    gap:1rem;
    overflow-x:auto;
    overflow-y:hidden;
    white-space:nowrap;
    -webkit-overflow-scrolling:touch;
    scroll-snap-type:x proximity;
    direction:rtl;
    padding:.25rem 0
  }
  .hscroll>a{
    flex:0 0 200px;
    height:150px;
    scroll-snap-align:start
  }
  .no-scrollbar::-webkit-scrollbar{display:none}
  .no-scrollbar{-ms-overflow-style:none;scrollbar-width:none}
  .scroll-wrapper{position:relative}
  .scroll-btn{
    position:absolute;
    top:50%;
    transform:translateY(-50%);
    background:#fff;
    color:var(--rukn-orange);
    border-radius:9999px;
    box-shadow:0 0 10px rgba(0,0,0,.1);
    width:38px;
    height:38px;
    display:grid;
    place-items:center;
    cursor:pointer;
    z-index:10;
    transition:all var(--transition);
    border:none;
    opacity:.9
  }
  .scroll-btn:hover{background:var(--rukn-orange);color:#fff;opacity:1}
  .scroll-btn.left{left:-50px}
  .scroll-btn.right{right:-50px}
  @media(max-width:767px){
    .scroll-btn{display:none}
  }

  .card-hover{transition:all var(--transition)}
  .card-hover:hover{transform:translateY(-5px);box-shadow:0 10px 25px rgba(0,0,0,.1)}

  .btn-primary{
    background:var(--rukn-orange);
    color:#fff;
    transition:all var(--transition);
    box-shadow:0 4px 6px rgba(255,122,24,.2)
  }
  .btn-primary:hover{
    background:#e56a00;
    transform:translateY(-2px);
    box-shadow:0 6px 12px rgba(255,122,24,.3)
  }
  .logo{transition:transform .5s ease}
  .logo:hover{transform:rotate(-5deg) scale(1.05)}

  .btn-green{
    background:var(--rukn-green);
    color:#fff;
    transition:all var(--transition);
    box-shadow:0 4px 6px rgba(22,163,74,.2)
  }
  .btn-green:hover{
    background:var(--rukn-green-700);
    transform:translateY(-2px);
    box-shadow:0 6px 12px rgba(22,163,74,.28)
  }
  .pill-green{color:var(--rukn-green);background:var(--rukn-green-50)}
  .ring-green{box-shadow:0 0 0 3px var(--rukn-green-100) inset}

  footer {
    background: #d1fae5;
    color: #065f46;
  }

  .section-box,
  .section-box-green {
    max-width: 1280px;
    margin: 3rem auto;
    padding: 3rem 1rem;
    border-radius: 1rem;
    background: #ffffff;
    border: 1px solid #e5e7eb;
    box-shadow: 0 8px 24px rgba(0, 0, 0, 0.03);
  }

  @media (min-width: 768px) {
    .section-box,
    .section-box-green {
      padding-inline: 2rem;
    }
  }
  @media (min-width: 1024px) {
    .section-box,
    .section-box-green {
      padding-inline: 3rem;
    }
  }

  /* Suggestions dropdown container */
  #searchSuggestionsBox {
      position: absolute;
      top: 100%;
      right: 0;
      left: 0;
      background: white;
      border: 1px solid #e5e7eb;
      border-radius: 0 0 1rem 1rem;
      padding: 0;
      box-shadow: 0 6px 25px rgba(0,0,0,0.08);
      z-index: 9999;
      max-height: 260px;
      overflow-y: auto;
  }

  @keyframes fadeIn {
      from { opacity: 0; transform: translateY(-4px); }
      to   { opacity: 1; transform: translateY(0); }
  }

  .topbar-icon {
    font-size: 1.35rem !important;   /* match index-30.html */
    padding: 0 6px !important;       /* spacing match */
  }
  </style>
</head>

<body>

<!-- TOP BAR -->
<div class="topbar">
  <div class="max-w-7xl mx-auto h-full px-4 sm:px-6 lg:px-8 flex items-center justify-between">

    <!-- Logo -->
    <a href="{% url 'home' %}" class="logo flex items-center gap-2">
      <img src="https://i.imgur.com/uJrPPeX.png" alt="Ø´Ø¹Ø§Ø± Ø±ÙƒÙ†" class="h-8 w-auto object-contain" />
    </a>

    <!-- Favs / Messages / Notifications / User -->
    <div class="flex items-center gap-4 text-[var(--muted)]">
      <!-- Favorites -->
      <div class="relative">
        <button id="favBtn" class="relative hover:text-gray-900 transition-colors topbar-icon" aria-expanded="false" aria-haspopup="true" aria-label="Ø§Ù„Ù…ÙØ¶Ù„Ø©">
          â¤ï¸
          {% if favorite_count %}
            <span class="badge">{{ favorite_count }}</span>
          {% endif %}
        </button>
        <div id="favMenu" class="dropdown" aria-labelledby="favBtn">
          <div class="dropdown-header">Ø§Ù„Ù…ÙØ¶Ù„Ø©</div>
          <div class="dropdown-list">
            {% for fav in recent_favorites %}
              {% with item=fav.item %}
              <a href="{% url 'item_detail' item.id %}" class="dropdown-item">
                <div class="w-12 h-12 rounded-md overflow-hidden bg-gray-100 border flex-shrink-0">
                  {% with photo=item.photos.first %}
                    {% if photo %}
                      <img src="{{ photo.image.url }}" alt="{{ item.title }}" class="w-full h-full object-cover">
                    {% else %}
                      <div class="w-full h-full flex items-center justify-center text-gray-400 text-xs">ğŸ–¼ï¸</div>
                    {% endif %}
                  {% endwith %}
                </div>
                <div>
                  <div class="font-medium text-gray-900 truncate">{{ item.title }}</div>
                  <div class="text-xs text-[var(--muted)]">{{ item.price }} Ø¯.Ø£</div>
                </div>
              </a>
              {% endwith %}
            {% empty %}
              <div class="px-4 py-3 text-sm text-gray-500">Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø¹Ù†Ø§ØµØ± ÙÙŠ Ø§Ù„Ù…ÙØ¶Ù„Ø©.</div>
            {% endfor %}
          </div>
          <div class="p-3 border-t">
            <a href="{% url 'my_favorites' %}" class="block text-center text-sm text-white bg-[var(--rukn-orange)] rounded-lg py-2 btn-primary">Ø¹Ø±Ø¶ ÙƒÙ„ Ø§Ù„Ù…ÙØ¶Ù„Ø©</a>
          </div>
        </div>
      </div>

      <!-- Messages -->
      <div class="relative">
        <button id="msgBtn" class="relative hover:text-gray-900 transition-colors topbar-icon" aria-expanded="false" aria-haspopup="true" aria-label="Ø§Ù„Ø±Ø³Ø§Ø¦Ù„">
          âœ‰ï¸
          {% if unread_messages %}
            <span class="badge">{{ unread_messages }}</span>
          {% endif %}
        </button>
        <div id="msgMenu" class="dropdown" aria-labelledby="msgBtn">
          <div class="dropdown-header">Ø§Ù„Ø±Ø³Ø§Ø¦Ù„</div>
          <div class="dropdown-list">
            {% for msg in recent_messages %}
              <a href="{% url 'chat_room' msg.conversation.id %}" class="dropdown-item {% if not msg.is_read %}bg-orange-50{% endif %}">
                <div class="flex-shrink-0 w-8 h-8 rounded-full bg-orange-100 text-orange-700 flex items-center justify-center text-xs font-semibold">
                  {{ msg.sender.username|first|upper }}
                </div>
                <div class="min-w-0">
                  <div class="flex justify-between gap-2">
                    <div class="font-medium text-gray-900 truncate">
                      {{ msg.sender.username }}
                    </div>
                    <div class="text-xs text-[var(--muted)] whitespace-nowrap">
                      {{ msg.created_at|timesince }} {% trans "ago" %}
                    </div>
                  </div>
                  <div class="text-xs text-gray-600 truncate">
                    {% if msg.conversation.item %}
                      {{ msg.conversation.item.title }}
                    {% else %}
                      {% trans "Conversation" %}
                    {% endif %}
                  </div>
                  <div class="text-xs text-gray-500 mt-0.5 line-clamp-2">
                    {{ msg.body }}
                  </div>
                </div>
              </a>
            {% empty %}
              <div class="px-4 py-3 text-sm text-gray-500">Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø±Ø³Ø§Ø¦Ù„.</div>
            {% endfor %}
          </div>
          <div class="p-3 border-t">
            <a href="{% url 'user_inbox' %}" class="block text-center text-sm text-white bg-[var(--rukn-orange)] rounded-lg py-2 btn-primary">ÙØªØ­ ØµÙ†Ø¯ÙˆÙ‚ Ø§Ù„Ø±Ø³Ø§Ø¦Ù„</a>
          </div>
        </div>
      </div>

      <!-- Notifications -->
      <div class="relative">
        <button id="notiBtn" class="relative hover:text-gray-900 transition-colors topbar-icon" aria-expanded="false" aria-haspopup="true" aria-label="Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª">
          ğŸ””
          {% if unread_notifications %}
            <span class="badge">{{ unread_notifications }}</span>
          {% endif %}
        </button>
        <div id="notiMenu" class="dropdown" aria-labelledby="notiBtn">
          <div class="dropdown-header">Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª</div>
          <div class="dropdown-list">
            {% for n in recent_notifications %}
              <div class="dropdown-item">
                <div class="flex-none w-10 h-10 rounded-full bg-green-50 text-green-600 flex items-center justify-content-center">âœ”ï¸</div>
                <div>
                  <div class="font-medium text-gray-900">{{ n.title }}</div>
                  <div class="text-xs text-[var(--muted)]">{{ n.created_at|timesince }} {% trans "ago" %}</div>
                </div>
              </div>
            {% empty %}
              <div class="px-4 py-3 text-sm text-gray-500">Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø¥Ø´Ø¹Ø§Ø±Ø§Øª.</div>
            {% endfor %}
          </div>
          <div class="p-3 border-t">
            <a href="{% url 'notifications' %}" class="block text-center text-sm text-white bg-[var(--rukn-orange)] rounded-lg py-2 btn-primary">ÙƒÙ„ Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª</a>
          </div>
        </div>
      </div>

      <!-- User -->
      <div class="relative">
        <button id="userBtn" class="flex items-center gap-2 transition-colors hover:text-gray-900" aria-expanded="false" aria-haspopup="true" aria-label="Ø­Ø³Ø§Ø¨ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…">
          <div class="w-7 h-7 rounded-full bg-gray-200 flex items-center justify-center text-xs font-semibold">
            {% if request.user.is_authenticated %}
              {{ request.user.username|first|upper }}
            {% else %}
              ?
            {% endif %}
          </div>
          <span class="hidden sm:inline-block">
            {% if request.user.is_authenticated %}
              Ù…Ø±Ø­Ø¨Ù‹Ø§ØŒ {{ request.user.username }}
            {% else %}
              Ø¶ÙŠÙ
            {% endif %}
          </span>
        </button>
        <div id="userMenu" class="dropdown w-44" aria-labelledby="userBtn">
          {% if request.user.is_authenticated %}
            <a href="{% url 'user_profile' request.user.user_id %}" class="block px-4 py-2 text-sm hover:bg-[var(--rukn-gray)] transition-colors">Ù…Ù„ÙÙŠ Ø§Ù„Ø´Ø®ØµÙŠ</a>
            <a href="{% url 'my_items' %}" class="block px-4 py-2 text-sm hover:bg-[var(--rukn-gray)] transition-colors">Ø¥Ø¹Ù„Ø§Ù†Ø§ØªÙŠ</a>
            {% if request.user.is_staff %}
              <a href="/admin/" class="block px-4 py-2 text-sm hover:bg-[var(--rukn-gray)] transition-colors">Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…</a>
            {% endif %}
            <a href="{% url 'logout' %}" class="block px-4 py-2 text-sm text-red-600 hover:bg-[var(--rukn-gray)] transition-colors">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬</a>
          {% else %}
            <a href="{% url 'login' %}" class="block px-4 py-2 text-sm hover:bg-[var(--rukn-gray)] transition-colors">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</a>
            <a href="{% url 'register' %}" class="block px-4 py-2 text-sm hover:bg-[var(--rukn-gray)] transition-colors">Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨</a>
          {% endif %}
        </div>
      </div>
    </div>
  </div>
</div>


<!-- HEADER + SEARCH -->
{% block searchbar %}
<header class="bg-white shadow-sm z-40">
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
    <div class="flex flex-col md:flex-row items-center justify-between gap-3 py-3">

      <div class="flex justify-center items-center py-6">
      </div>

      <div class="w-full px-3 mt-2 md:mt-0">
        <form id="siteSearch"
              action="{% url 'item_list' %}"
              method="get"
              class="flex flex-col sm:flex-row items-stretch gap-2 w-full">

          <!-- SEARCH INPUT -->
          <div class="relative flex-1">

            <input id="searchInput"
                  name="q"
                  type="search"
                  autocomplete="off"
                  placeholder="Ø§Ø¨Ø­Ø« Ø¹Ù† Ø§Ø¹Ù„Ø§Ù† Ø£Ùˆ Ø·Ù„Ø¨"
                  class="w-full text-base md:text-lg rounded-3xl border-2 border-[var(--rukn-orange)]
                        py-2.5 px-4 pr-36 focus:outline-none focus:ring-2 focus:ring-orange-200
                        transition-all duration-300"
                  required />

            <!-- BUY / SELL TOGGLE -->
            <div id="intentBox"
                class="absolute right-2 top-1/2 -translate-y-1/2 flex border border-gray-200 shadow-sm bg-white overflow-hidden rounded-2xl">

              <button id="sellBtn" type="button"
                      class="w-[58px] h-8 text-sm font-extrabold text-white bg-[var(--rukn-orange)]">
                Ø¨ÙŠØ¹
              </button>

              <button id="buyBtn" type="button"
                      class="w-[58px] h-8 text-sm font-extrabold text-gray-600 bg-white">
                Ø´Ø±Ø§Ø¡
              </button>

            </div>

            <!-- SEARCH BUTTON -->
            <button id="searchBtn"
                    type="submit"
                    disabled
                    class="absolute left-2 top-1/2 -translate-y-1/2 bg-[var(--rukn-orange)] text-white
                          w-8 h-8 rounded-3xl flex items-center justify-center shadow-md hover:scale-105
                          transition-all duration-300 disabled:opacity-40 disabled:cursor-not-allowed">

              <svg xmlns="http://www.w3.org/2000/svg"
                    class="w-4 h-4"
                    fill="none"
                    viewBox="0 0 24 24"
                    stroke="currentColor"
                    stroke-width="2">
                <path stroke-linecap="round" stroke-linejoin="round"
                      d="M21 21l-4.35-4.35M10.5 18a7.5 7.5 0 1 1 0-15 7.5 7.5 0 0 1 0 15z" />
              </svg>
            </button>

            <!-- SUGGESTIONS DROPDOWN -->
            <div id="searchSuggestionsBox"
                  class="absolute z-40 mt-2 w-full bg-white border border-gray-200 rounded-xl shadow-lg text-sm hidden">
            </div>

          </div>

          <!-- ADD AD BUTTON -->
          <a id="addAdBtn" href="{% url 'create_item' %}"
              class="text-center text-sm font-extrabold text-white bg-[var(--rukn-orange)]
                    px-6 py-4 rounded-3xl shadow-md hover:shadow-lg transition-all duration-300
                    w-full sm:w-auto">
            Ø£Ø¶Ù Ø¥Ø¹Ù„Ø§Ù†Ùƒ
          </a>

        </form>
      </div>

    </div>
  </div>
</header>
{% endblock %}




<!-- CONTENT -->
<main class="mt-6 md:mt-8">
  {% block content %}{% endblock %}
</main>


<!-- FOOTER -->
<footer class="bg-gradient-to-t from-green-100 via-green-50 to-white text-[#065f46] pt-10 pb-6 border-t border-green-200 mt-10">
  <div class="max-w-7xl mx-auto px-6 grid md:grid-cols-4 gap-10">
    <div>
      <div class="flex items-center gap-3 mb-3">
        <img src="https://i.imgur.com/uJrPPeX.png" alt="Ø´Ø¹Ø§Ø± Ø±ÙƒÙ†" class="h-12 w-auto object-contain rounded-md shadow-sm" />
      </div>
      <p class="text-sm leading-7 text-[#065f46]/80">
        Ù…Ù†ØµØ© Ø¨ÙŠØ¹ Ùˆ Ø´Ø±Ø§Ø¡ Ù„Ù„Ø¬Ù…ÙŠØ¹
        Ø§Ø¨Ø­Ø« Ø¹Ù† Ø§Ù„Ù…Ù†ØªØ¬ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨ Ùˆ ØªÙˆØ§ØµÙ„ Ù…Ø¹ Ø§Ù„Ø¨Ø§Ø¦Ø¹
        Ù„Ù… ØªØ¬Ø¯ Ø§Ù„Ù…Ù†ØªØ¬ ... Ù„Ø§ ØªÙ‚Ù„Ù‚ Ø¨Ø¥Ù…ÙƒØ§Ù†Ùƒ ØªÙ‚Ø¯ÙŠÙ… Ø·Ù„Ø¨
        Ùˆ Ø³ÙŠÙ‚ÙˆÙ… Ø§Ù„Ø¨Ø§Ø¦Ø¹ÙŠÙ† Ø¨Ø§Ù„ØªÙˆØ§ØµÙ„ Ù…Ø¹Ùƒ
      </p>
    </div>

    <div>
      <h4 class="font-semibold mb-3 text-[#065f46]">Ø±ÙˆØ§Ø¨Ø· Ø³Ø±ÙŠØ¹Ø©</h4>
      <ul class="space-y-2 text-sm">
        <li><a href="{% url 'item_list' %}" class="hover:text-[var(--rukn-orange)] transition-colors">ØªØµÙØ­ Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†Ø§Øª</a></li>
        <li><a href="{% url 'contact' %}" class="hover:text-[var(--rukn-orange)] transition-colors">Ø§ØªØµÙ„ Ø¨Ù†Ø§</a></li>
      </ul>
    </div>

    <div>
      <h4 class="font-semibold mb-3 text-[#065f46]">Ø§Ù„Ø£Ù‚Ø³Ø§Ù…</h4>
      <ul class="space-y-2 text-sm">
        <li><a href="{% url 'category_list' %}" class="hover:text-[var(--rukn-orange)] transition-colors">ÙƒÙ„ Ø§Ù„Ø£Ù‚Ø³Ø§Ù…</a></li>
      </ul>
    </div>

    <div>
      <h4 class="font-semibold mb-3 text-[#065f46]">ØªÙˆØ§ØµÙ„ Ù…Ø¹Ù†Ø§</h4>
      <p class="text-sm mb-3">ğŸ“§ info@rokon.example</p>
      <div class="flex gap-4 text-xl">
        <a href="#" aria-label="Facebook" class="hover:text-[var(--rukn-orange)] transition-colors">ğŸ“˜</a>
        <a href="#" aria-label="Twitter" class="hover:text-[var(--rukn-orange)] transition-colors">ğŸ¦</a>
        <a href="#" aria-label="Instagram" class="hover:text-[var(--rukn-orange)] transition-colors">ğŸ“¸</a>
      </div>
    </div>
  </div>

  <div class="border-t border-green-200 mt-10 pt-4 text-center text-sm text-[#065f46]/80">
     Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ‚ Ù…Ø­ÙÙˆØ¸Ø©<span class="font-semibold text-[#065f46]"> - Ø±ÙƒÙ† - </span> Â© 2025
  </div>
</footer>


<!-- JS: dropdowns + search -->
<!-- JS: dropdowns + search -->
<script>
/* =========================================================
   FEATURE FLAG: suggestions mode
   true  => categories + items (modern)
   false => categories only (fallback)
========================================================= */
const ENABLE_ITEM_SUGGESTIONS = true;

/* =========================================================
   NAVBAR DROPDOWNS
========================================================= */
const menus = {
  fav:  { btn: document.getElementById("favBtn"),  menu: document.getElementById("favMenu") },
  msg:  { btn: document.getElementById("msgBtn"),  menu: document.getElementById("msgMenu") },
  noti: { btn: document.getElementById("notiBtn"), menu: document.getElementById("notiMenu") },
  user: { btn: document.getElementById("userBtn"), menu: document.getElementById("userMenu") }
};

function closeAll(except) {
  Object.keys(menus).forEach(k => {
    const o = menus[k];
    if (!o.btn || !o.menu) return;
    if (k !== except) {
      o.menu.classList.remove("show");
      o.btn.setAttribute("aria-expanded", "false");
    }
  });
}

Object.keys(menus).forEach(key => {
  const o = menus[key];
  if (!o.btn || !o.menu) return;
  o.btn.addEventListener("click", e => {
    e.stopPropagation();
    const isOpen = o.menu.classList.contains("show");
    closeAll(key);
    if (!isOpen) {
      o.menu.classList.add("show");
      o.btn.setAttribute("aria-expanded", "true");
    }
  });
});

document.addEventListener("click", () => closeAll(null));
document.addEventListener("keydown", e => { if (e.key === "Escape") closeAll(null); });

/* =========================================================
   SEARCH + SUGGESTIONS + FULL BUY/SELL UI
========================================================= */
const input    = document.getElementById("searchInput");
const button   = document.getElementById("searchBtn");
const form     = document.getElementById("siteSearch");
const box      = document.getElementById("searchSuggestionsBox");
const buyBtn   = document.getElementById("buyBtn");
const sellBtn  = document.getElementById("sellBtn");
const addAdBtn = document.getElementById("addAdBtn");
const intentBox = document.getElementById("intentBox");

if (input && button && form && box) {
  let typingTimer = null;
  let isBuy = false; // default: Ø¨ÙŠØ¹ (sell / orange)

  /* ---------- MAIN UI UPDATE (orange/green) ---------- */
  function updateUI() {
    const color   = isBuy ? "#16a34a" : "var(--rukn-orange)";
    const btnText = isBuy ? "Ø£Ø¶Ù Ø·Ù„Ø¨Ùƒ" : "Ø£Ø¶Ù Ø¥Ø¹Ù„Ø§Ù†Ùƒ";
    const hasText = input.value.trim().length > 0;

    // Toggle small Ø¨ÙŠØ¹/Ø´Ø±Ø§Ø¡ buttons
    if (buyBtn && sellBtn) {
      if (isBuy) {
        buyBtn.style.backgroundColor = "#16a34a";
        buyBtn.style.color = "white";

        sellBtn.style.backgroundColor = "#ffffff";
        sellBtn.style.color = "#6b7280";
      } else {
        sellBtn.style.backgroundColor = "var(--rukn-orange)";
        sellBtn.style.color = "white";

        buyBtn.style.backgroundColor = "#ffffff";
        buyBtn.style.color = "#6b7280";
      }
    }

    // Border around the toggle
    if (intentBox) {
      intentBox.style.borderColor = isBuy ? "#16a34a" : "var(--rukn-orange)";
    }

    // Search input border
    input.style.borderColor = color;

    // Search button color
    button.style.backgroundColor = color;

    // Enable/disable search button depending on text
    button.disabled = !hasText;
    button.style.opacity = hasText ? "1" : "0.5";
    button.style.cursor  = hasText ? "pointer" : "not-allowed";

    // "Add Ad" button (color + text)
    if (addAdBtn) {
      addAdBtn.style.backgroundColor = color;
      addAdBtn.textContent = btnText;
    }
  }

  // Click handlers for Ø¨ÙŠØ¹ / Ø´Ø±Ø§Ø¡
  if (buyBtn && sellBtn) {
    sellBtn.addEventListener("click", () => {
      isBuy = false;
      updateUI();
    });
    buyBtn.addEventListener("click", () => {
      isBuy = true;
      updateUI();
    });
  }

  /* ---------- Highlight helper (for suggestions) ---------- */
  function highlight(text, q) {
    let i = text.toLowerCase().indexOf(q.toLowerCase());
    if (i < 0) return text;
    return (
      text.substring(0, i) +
      '<span class="text-[var(--rukn-orange)] font-bold">' +
      text.substring(i, i + q.length) +
      "</span>" +
      text.substring(i + q.length)
    );
  }

  /* ---------- Render one suggestion row ---------- */
  function renderSuggestion(entry, query) {
    let row = document.createElement("div");
    row.className =
      "flex items-center gap-3 px-4 py-3 cursor-pointer hover:bg-gray-50 transition border-b last:border-none";

    // ICON / THUMB
    let iconBox = document.createElement("div");
    iconBox.className = "flex-shrink-0";

    if (entry.type === "item") {
      let img = document.createElement("img");
      img.src = entry.photo_url || "/static/img/no-image.png";
      img.className = "w-10 h-10 rounded-md object-cover border";
      iconBox.appendChild(img);
    } else {
      let emoji = document.createElement("div");
      emoji.className = "text-2xl opacity-80";
      emoji.textContent = entry.emoji || "ğŸ“‚";
      iconBox.appendChild(emoji);
    }

    // TEXTS
    let wrapper = document.createElement("div");
    wrapper.className = "flex flex-col";

    let title = document.createElement("span");
    title.className = "font-medium text-gray-800";
    title.innerHTML = highlight(entry.name, query);
    wrapper.appendChild(title);

    let sub = document.createElement("span");
    sub.className = "text-xs text-gray-500";
    if (entry.type === "item") {
      sub.textContent = entry.category || "Ø¥Ø¹Ù„Ø§Ù†";
    } else {
      sub.textContent = entry.parent || "";
    }
    wrapper.appendChild(sub);

    row.appendChild(iconBox);
    row.appendChild(wrapper);

    // CLICK BEHAVIOR
    row.onclick = () => {
      if (entry.type === "category") {
        window.location.href =
          `/${document.documentElement.lang}/items/?categories=${entry.category_id}`;
      } else {
        window.location.href =
          `/${document.documentElement.lang}/item/${entry.id}/`;
      }
    };

    return row;
  }

  /* ---------- Fuzzy match ---------- */
  function fuzzyMatch(str, q) {
    if (!str) return false;

    str = str.toLowerCase();
    q = q.toLowerCase();

    if (str.includes(q)) return true;

    let mismatches = 0;
    let i = 0, j = 0;

    while (i < str.length && j < q.length) {
      if (str[i] !== q[j]) {
        mismatches++;
        if (mismatches > 2) return false;
        j++;
      } else {
        i++;
        j++;
      }
    }
    return true;
  }

  /* ---------- Load suggestions from backend ---------- */
  function loadSuggestions(q) {
    if (q.length < 2) {
      box.classList.add("hidden");
      return;
    }

    fetch(`/${document.documentElement.lang}/search/suggestions/?q=${encodeURIComponent(q)}`)
      .then(r => r.json())
      .then(data => {
        box.innerHTML = "";
        const all = data.results || [];

        let categories = all.filter(x => x.type === "category");
        let items      = ENABLE_ITEM_SUGGESTIONS ? all.filter(x => x.type === "item") : [];

        if (!categories.length && !items.length) {
          box.classList.add("hidden");
          return;
        }

        // Categories group
        if (categories.length) {
          let label = document.createElement("div");
          label.className =
            "px-4 py-2 text-xs font-bold text-gray-500 bg-gray-100 border-b";
          label.textContent = "Ø§Ù„Ø£Ù‚Ø³Ø§Ù…";
          box.appendChild(label);

          categories
            .filter(e => fuzzyMatch(e.name, q))
            .forEach(entry => box.appendChild(renderSuggestion(entry, q)));
        }

        // Items group
        if (items.length) {
          let label = document.createElement("div");
          label.className =
            "px-4 py-2 text-xs font-bold text-gray-500 bg-gray-100 border-b mt-1";
          label.textContent = "Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†Ø§Øª";
          box.appendChild(label);

          items
            .filter(e => fuzzyMatch(e.name, q))
            .forEach(entry => box.appendChild(renderSuggestion(entry, q)));
        }

        box.classList.remove("hidden");
      });
  }

  /* ---------- Live search results (for item_list page) ---------- */
  function performSearch() {
    let q = input.value.trim();
    if (!q) return;

    fetch(`/${document.documentElement.lang}/items/?q=${encodeURIComponent(q)}`, {
      headers: { "HX-Request": "true" }
    })
      .then(r => r.text())
      .then(html => {
        const results = document.getElementById("results");
        if (results) results.innerHTML = html;
      });
  }

  /* ---------- Typing events ---------- */
  input.addEventListener("input", () => {
    clearTimeout(typingTimer);
    updateUI();  // update button colors + enable/disable

    let q = input.value.trim();

    if (!q) {
      box.classList.add("hidden");
      return;
    }

    typingTimer = setTimeout(() => {
      loadSuggestions(q);
      performSearch();
    }, 350);
  });

  /* ---------- Enter submits search immediately ---------- */
  input.addEventListener("keydown", e => {
    if (e.key === "Enter") {
      e.preventDefault();
      box.classList.add("hidden");
      performSearch();
    }
  });

  /* ---------- Search button click ---------- */
  button.addEventListener("click", e => {
    if (button.disabled) return;
    e.preventDefault();
    box.classList.add("hidden");
    performSearch();
  });

  /* Initial state (orange theme, disabled search) */
  updateUI();
}

/* =========================================================
   Scroll buttons for categories strip
========================================================= */
function updateScrollButtons(){
  const container = document.getElementById('catsScroll');
  const leftBtn   = document.querySelector('.scroll-btn.left');
  const rightBtn  = document.querySelector('.scroll-btn.right');
  if (!container || !leftBtn || !rightBtn) return;
  leftBtn.style.opacity  = container.scrollLeft > 0 ? "1" : "0.5";
  rightBtn.style.opacity = container.scrollLeft < (container.scrollWidth - container.clientWidth) ? "1" : "0.5";
}

document.getElementById('catsScroll')?.addEventListener('scroll', updateScrollButtons);
window.addEventListener('load', updateScrollButtons);

function scrollCats(dir){
  const c = document.getElementById('catsScroll');
  if (!c) return;
  c.scrollBy({left: dir*220, behavior:'smooth'});
  setTimeout(updateScrollButtons, 300);
}
window.scrollCats = scrollCats;
</script>

{% block scripts %}{% endblock %}

</body>
</html>
