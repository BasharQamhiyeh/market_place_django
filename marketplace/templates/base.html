{% load static i18n %}
<!DOCTYPE html>
<html lang="{{ LANGUAGE_CODE }}" dir="{% if LANGUAGE_CODE == 'ar' %}rtl{% else %}ltr{% endif %}">
<head>
  <!-- âœ… Select2 CSS -->
  <link href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css" rel="stylesheet" />

  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>{% block title %}Site{% endblock %}</title>
  <link rel="stylesheet" href="{% static 'css/style.css' %}">
  {% block head %}{% endblock %}
</head>
<body>

<header style="padding:10px;border-bottom:1px solid #ccc;display:flex;justify-content:space-between;">
  <div>
    <a href="/">{% trans "Home" %}</a>
  </div>

  <div style="display:flex;align-items:center;gap:14px;">
    {% if user.is_authenticated and user.is_staff %}
        <a href="{% url 'admin:index' %}">{% trans "Admin Dashboard" %}</a> |
    {% endif %}

    {% if request.user.is_authenticated %}
      <a href="{% url 'notifications' %}">
          ðŸ””
          {% if unread_notifications > 0 %}
              <span style="background:red;color:white;padding:2px 6px;border-radius:50%;">
                  {{ unread_notifications }}
              </span>
          {% endif %}
      </a>

      <a href="{% url 'user_inbox' %}">
          ðŸ’¬
          {% if unread_messages > 0 %}
              <span style="background:red;color:white;padding:2px 6px;border-radius:50%;">
                  {{ unread_messages }}
              </span>
          {% endif %}
      </a>
    {% endif %}

    {% if request.user.is_authenticated %}
      <div class="profile-dropdown" id="profileDropdown">
        <button type="button" class="profile-button" onclick="toggleDropdown()"
                style="background:none;border:0;display:flex;align-items:center;gap:8px;cursor:pointer;">
            <img src="{% static 'img/profile-icon.png' %}" alt="profile icon"
                 style="width:32px;height:32px;border-radius:50%;object-fit:cover;">
            {{ request.user.username }}
        </button>

        <div class="dropdown-menu">
          <a href="{% url 'user_profile' request.user.user_id %}">{% trans "My Profile" %}</a>
          <a href="{% url 'my_items' %}">{% trans "My Items" %}</a>
          <a href="{% url 'my_favorites' %}">{% trans "My Favorites" %}</a>
          <a href="{% url 'user_inbox' %}">{% trans "My Messages" %}</a>
          <a href="{% url 'notifications' %}">{% trans "Notifications" %}</a>
          <a href="{% url 'create_item' %}">{% trans "Post an Ad" %}</a>
          <a href="{% url 'logout' %}" style="color:#dc3545;">{% trans "Logout" %}</a>
        </div>
      </div>
    {% else %}
      <a href="{% url 'login' %}">{% trans "Login" %}</a> |
      <a href="{% url 'register' %}">{% trans "Register" %}</a>
    {% endif %}

    <form action="{% url 'set_language' %}" method="post">
      {% csrf_token %}
      <select name="language" onchange="this.form.submit()">
        <option value="en" {% if LANGUAGE_CODE == 'en' %}selected{% endif %}>English</option>
        <option value="ar" {% if LANGUAGE_CODE == 'ar' %}selected{% endif %}>Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©</option>
      </select>
    </form>
  </div>
</header>

<main>
  {% block content %}{% endblock %}
</main>

<!-- âœ… HTMX -->
<script src="https://unpkg.com/htmx.org@1.9.12"></script>

<!-- âœ… jQuery (required by Select2) -->
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

<!-- âœ… Select2 JS -->
<script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>

<script>
function toggleDropdown() {
  document.getElementById("profileDropdown").classList.toggle("active");
}
document.addEventListener("click", function(e){
  const dd = document.getElementById("profileDropdown");
  if (dd && !e.target.closest("#profileDropdown")) dd.classList.remove("active");
});

// âœ… Initialize all searchable selects
document.addEventListener("DOMContentLoaded", function() {
  $("select.searchable-select").select2({
    width: "100%",
    placeholder: "Select an option",
    allowClear: true
  });
});
</script>

{% block scripts %}{% endblock %}
</body>
</html>
