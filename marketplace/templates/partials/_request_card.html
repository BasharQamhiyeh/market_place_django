{# templates/partials/_request_card.html #}
{% load i18n timeago_ar %}

<a href="{% url 'request_detail' req.id %}" class="req-card-link">
  <article class="req-card group">

    <!-- HOVER MASK -->
    <div class="req-hover-mask"></div>

    <!-- HOVER HINT -->
    <div class="req-hint-container" aria-hidden="true">
      <div class="req-hint-text">
        <span>عرض</span>
        <span>الطلب</span>
      </div>
      <span class="req-hint-arrow">
        <svg xmlns="http://www.w3.org/2000/svg" fill="none"
             viewBox="0 0 24 24" stroke-width="1.8" stroke="currentColor"
             class="w-5 h-5">
          <path stroke-linecap="round" stroke-linejoin="round"
                d="m18.75 4.5-7.5 7.5 7.5 7.5m-6-15L5.25 12l7.5 7.5" />
        </svg>
      </span>
    </div>

    <!-- TOP PILLS -->
    <div class="req-top">
      {% if req.listing.category %}
        <span class="req-pill req-pill-category">
          {% if LANGUAGE_CODE == "ar" %}
            {{ req.listing.category.name_ar }}
          {% else %}
            {{ req.listing.category.name_en }}
          {% endif %}
        </span>
      {% endif %}

      {% if req.featured or req.listing.is_featured %}
        <span class="req-pill req-pill-featured">مميز</span>
      {% endif %}
    </div>

    <!-- TITLE -->
    <h3 class="req-title">
      {{ req.listing.title }}
    </h3>

    <!-- META INFO -->
    <div class="req-meta">
      <span class="req-meta-item">
        <svg class="req-meta-icon" viewBox="0 0 24 24" fill="none">
          <path d="M12 22s7-6 7-12a7 7 0 1 0-14 0c0 6 7 12 7 12z"
                stroke="currentColor" stroke-width="2" />
          <circle cx="12" cy="10" r="2.5" stroke="currentColor" stroke-width="2" />
        </svg>
        <span>
          {% if req.listing.city %}
            {{ req.listing.city.name_ar|default:req.listing.city }}
          {% else %}
            —
          {% endif %}
        </span>
      </span>

      <span class="req-meta-item">
        <svg class="req-meta-icon" viewBox="0 0 24 24" fill="none">
          <rect x="3" y="4" width="18" height="18" rx="3"
                stroke="currentColor" stroke-width="2" />
          <path d="M8 2v4M16 2v4M3 10h18"
                stroke="currentColor" stroke-width="2" />
        </svg>
        <span>
          {% with r=req.listing.updated_at|default:req.listing.created_at %}
            {% if r %}{{ r|timeago_ar }}{% endif %}
          {% endwith %}
        </span>
      </span>
    </div>

    <!-- FOOTER -->
    <div class="req-footer">
      <div class="req-budget-container">
        <span class="req-budget-price">
          {% if req.budget %}
            {{ req.budget|floatformat:0 }} د.أ
          {% else %}
            {% trans "حسب الطلب" %}
          {% endif %}
        </span>
        <span class="req-budget-label">لغاية</span>
      </div>

      <div class="req-user">
        {% with u=req.listing.user %}
          {% if u.profile_photo %}
            <img src="{{ u.profile_photo.url }}" class="req-avatar" alt="{{ u.username|default:u.phone }}">
          {% else %}
            <div class="req-avatar-fallback" aria-hidden="true">
              {% with fn=u.first_name|default:"" un=u.username|default:"" ph=u.phone|default:"" %}
                {% if fn %}
                  {{ fn|slice:":1"|upper }}
                {% elif un %}
                  {{ un|slice:":1"|upper }}
                {% elif ph %}
                  {{ ph|slice:":1"|upper }}
                {% else %}
                  ?
                {% endif %}
              {% endwith %}
            </div>
          {% endif %}

          <span class="req-user-name">
            {% if u.username %}
              {{ u.username }}
            {% else %}
              {{ u.first_name }}
            {% endif %}
          </span>
        {% endwith %}
      </div>
    </div>

  </article>
</a>