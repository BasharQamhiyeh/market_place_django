{# templates/partials/item_results.html #}
{% load i18n %}

{% if page_obj and page_obj.object_list %}
  <div class="row g-3">
    {% for item in page_obj %}
      <div class="col-12 col-md-6 col-lg-4">
        <div class="card h-100 shadow-sm border-0">
          {% if item.photos.all %}
            <img src="{{ item.photos.all.0.image.url }}" class="card-img-top" alt="{{ item.title }}" style="height:200px;object-fit:cover;">
          {% else %}
            <div class="bg-light d-flex align-items-center justify-content-center" style="height:200px;">
              <span class="text-muted">{% trans "No image" %}</span>
            </div>
          {% endif %}
          <div class="card-body">
            <h6 class="card-title fw-semibold mb-1">{{ item.title }}</h6>

            <!-- ✅ Category + Subcategory + City -->
            <p class="text-muted small mb-1">
              {% if item.category.parent %}
                {{ item.category.parent }} › {{ item.category }}
              {% else %}
                {{ item.category }}
              {% endif %}
              {% if item.city %}
                • {{ item.city }}
              {% endif %}
            </p>

            <p class="card-text small text-truncate-3">{{ item.description|truncatechars:100 }}</p>
          </div>
          <div class="card-footer bg-white border-0 d-flex justify-content-between align-items-center">
            <span class="fw-bold">{{ item.price }} JOD</span>
            <a href="{% url 'item_detail' item.id %}" class="btn btn-sm btn-jordan-outline">{% trans "View" %}</a>
          </div>
        </div>
      </div>
    {% endfor %}
  </div>

  <!-- ✅ Pagination -->
  <nav class="mt-4 d-flex justify-content-center align-items-center gap-3">
    {% if page_obj.has_previous %}
      <a class="btn btn-sm btn-outline-secondary"
         hx-get="?page={{ page_obj.previous_page_number }}{% if q %}&q={{ q }}{% endif %}"
         hx-target="#results"
         hx-push-url="true">
         &laquo; {% trans "Previous" %}
      </a>
    {% endif %}

    <span class="text-muted small">
      {% trans "Page" %} {{ page_obj.number }} {% trans "of" %} {{ page_obj.paginator.num_pages }}
    </span>

    {% if page_obj.has_next %}
      <a class="btn btn-sm btn-outline-secondary"
         hx-get="?page={{ page_obj.next_page_number }}{% if q %}&q={{ q }}{% endif %}"
         hx-target="#results"
         hx-push-url="true">
         {% trans "Next" %} &raquo;
      </a>
    {% endif %}
  </nav>
{% else %}
  <div class="alert alert-info mb-0 mt-3">
    {% trans "No items found." %}
  </div>
{% endif %}
