{# templates/partials/_item_card.html #}
{% load i18n %}

<article class="bg-white rounded-xl overflow-hidden
               border border-orange-200
               transition-all duration-300
               shadow-[0_4px_14px_rgba(0,0,0,0.08)]
               hover:shadow-[0_12px_32px_rgba(0,0,0,0.18)]
               hover:border-orange-400
               hover:-translate-y-2 hover:scale-[1.015]
               relative">

  <!-- IMAGE + HEART + CATEGORY BADGE -->
  <div class="relative">

    {% with p=item.main_photo %}
      {% if p %}
        {% if p.thumbnail %}
          <img src="{{ p.thumbnail.url }}"
               alt="{{ item.listing.title }}"
               class="w-full h-[260px] object-cover hover:scale-105 transition-transform duration-300 rounded-none" />
        {% else %}
          <img src="{{ p.image.url }}"
               alt="{{ item.listing.title }}"
               class="w-full h-[260px] object-cover hover:scale-105 transition-transform duration-300 rounded-none" />
        {% endif %}
      {% else %}
        <div class="w-full h-[260px] bg-gray-100 flex items-center justify-center text-sm text-gray-400">
          {% trans "No image" %}
        </div>
      {% endif %}
    {% endwith %}

    <!-- Heart -->
    {% if request.user.is_authenticated %}
      <form class="absolute bottom-2 left-2 z-50"
            method="post"
            action="{% url 'toggle_favorite' item.id %}"
            onsubmit="toggleFavorite(event, {{ item.id }}, this)">
        {% csrf_token %}
        <button type="submit"
                class="heart-btn text-2xl transition duration-200 hover:scale-110"
                aria-label="{% trans 'Toggle favorite' %}">
          {% if item.is_favorited %}
            â¤ï¸
          {% else %}
            ğŸ¤
          {% endif %}
        </button>
      </form>
    {% else %}
      <button type="button"
              onclick="document.getElementById('loginModal').classList.remove('hidden')"
              class="absolute bottom-2 left-2 heart-btn text-2xl z-50 transition duration-200 hover:scale-110"
              aria-label="{% trans 'Login to favorite' %}">
        ğŸ¤
      </button>
    {% endif %}

    <!-- Category badge -->
    {% if item.listing.category %}
      <span class="absolute top-3 right-3
                   bg-white/90 text-gray-800 text-xs font-semibold
                   px-3 py-1 rounded-full shadow-sm
                   flex items-center gap-1 border border-orange-300">
        {% if item.listing.category.icon %}
          {{ item.listing.category.icon }}
        {% else %}
          ğŸ·ï¸
        {% endif %}

        {% if LANGUAGE_CODE == "ar" %}
          {{ item.listing.category.name_ar }}
        {% else %}
          {{ item.listing.category.name_en }}
        {% endif %}
      </span>
    {% endif %}
  </div>

  <!-- CONTENT -->
  <div class="p-4">
    <!-- Title -->
    <h3 class="font-semibold text-lg line-clamp-2 min-h-[55px] text-gray-900"
        title="{{ item.listing.title }}">
      {{ item.listing.title }}
    </h3>

    <!-- City + Time -->
    <div class="flex items-center justify-between text-sm text-[var(--muted)] mt-2">
      <span>
        ğŸ“
        {% if item.listing.city %}
          {{ item.listing.city }}
        {% else %}
          â€”
        {% endif %}
      </span>

      <span>
        â±ï¸
        {% with t=item.listing.updated_at|default:item.listing.created_at %}
          {% if t %}
            {% if t|timesince == "0 minutes" %}
              Ø§Ù„Ø¢Ù†
            {% else %}
              {% trans "Since" %} {{ t|timesince }}
            {% endif %}
          {% endif %}
        {% endwith %}
      </span>
    </div>
  </div>

  <!-- FOOTER -->
  <div class="flex items-center justify-between p-4 border-t border-gray-100 bg-white">

    <!-- Seller -->
    <div class="flex items-center gap-2">
      <div class="w-8 h-8 rounded-full bg-gray-200 flex items-center justify-center
                  text-xs font-bold text-gray-700 shadow">
        {% with fn=item.listing.user.first_name|default:"" un=item.listing.user.username|default:"" %}
          {% if fn %}
            {{ fn|slice:":1"|upper }}
          {% elif un %}
            {{ un|slice:":1"|upper }}
          {% else %}
            ?
          {% endif %}
        {% endwith %}
      </div>

      <span class="text-sm font-medium text-gray-800 truncate max-w-[110px]">
        {% if item.listing.user %}
          {{ item.listing.user.username }}
        {% else %}
          {% trans "Unknown" %}
        {% endif %}
      </span>
    </div>

    <!-- Price -->
    <div class="text-white text-base font-bold rounded-3xl shadow text-center min-w-[90px] py-2 px-4 bg-[var(--rukn-orange)]">
      {{ item.price|floatformat:0 }} Ø¯.Ø£
    </div>

  </div>

  <!-- CLICKABLE OVERLAY (keep it UNDER the heart) -->
  <a href="{% url 'item_detail' item.id %}"
     class="absolute inset-0 z-0 pointer-events-auto"
     aria-label="{% trans 'View Details' %}"></a>

</article>
