{# templates/partials/item_attributes.html #}
{% load form_extras %}

<div id="attrsRoot" class="space-y-4">
  {% for field in form %}
    {% if field.name|slice:":5" == "attr_" and field.name|slice:"-6:" != "_other" %}

      <div class="attr-block mb-3"
           data-field-name="{{ field.html_name }}"
           {% if field.field.required %}data-required="1"{% endif %}>

        <label class="label">{{ field.label }}</label>

        {# ================= TEXT / NUMBER / TEXTAREA ================= #}
        {% if field.field.widget.input_type == "text" or field.field.widget.input_type == "number" %}
          {{ field|add_class:"input-field text-sm" }}

        {% elif field.field.widget.input_type == "textarea" %}
          {{ field|add_class:"input-field text-sm" }}

        {# ================= RADIO (MOCKUP STYLE) ================= #}
        {% elif field.field.widget.input_type == "radio" %}
          <div class="grid grid-cols-1 sm:grid-cols-2 gap-3 mt-2">
            {% for value,label in field.field.choices %}
              {% if value %}
                <label class="elect-card flex items-center gap-2 border border-orange-200 rounded-xl p-3 cursor-pointer bg-white">
                  <input type="radio"
                         name="{{ field.html_name }}"
                         value="{{ value }}"
                         {% if field.value|stringformat:"s" == value|stringformat:"s" %}checked{% endif %}>
                  <span class="font-semibold text-sm">{{ label }}</span>
                </label>
              {% endif %}
            {% endfor %}
          </div>

        {# ================= CHECKBOX LIST (MOCKUP STYLE) ================= #}
        {% elif field.field.widget.input_type == "checkbox" and field.field.widget.allow_multiple_selected %}
          <div class="grid grid-cols-1 sm:grid-cols-2 gap-3 mt-2">
            {% for value,label in field.field.choices %}
              {% if value %}
                <label class="elect-card flex items-center gap-2 border border-orange-200 rounded-xl p-3 cursor-pointer bg-white">
                  <input type="checkbox"
                         name="{{ field.html_name }}"
                         value="{{ value }}"
                         {% if field.value and value in field.value %}checked{% endif %}>
                  <span class="font-semibold text-sm">{{ label }}</span>
                </label>
              {% endif %}
            {% endfor %}
          </div>

        {# ================= SELECT (DROPDOWN) ================= #}
        {% elif field.field.widget.input_type == "select" %}
          {{ field|add_class:"input-field text-sm" }}

        {# ================= FALLBACK ================= #}
        {% else %}
          {{ field|add_class:"input-field text-sm" }}
        {% endif %}

        {# keep server errors #}
        {% if field.errors %}
          <p class="field-error js-error">{{ field.errors }}</p>
        {% endif %}

        {# ================= OTHER FIELD (HIDDEN) ================= #}
        {% with other_name=field.name|add:"_other" %}
          {% if other_name in form.fields %}
            {% with other_field=form|getitem:other_name %}
              <div class="other-wrapper mt-2 hidden">
                {{ other_field|add_class:"input-field text-sm" }}
                {% if other_field.errors %}
                  <p class="field-error js-error">{{ other_field.errors }}</p>
                {% endif %}
              </div>
            {% endwith %}
          {% endif %}
        {% endwith %}

      </div>
    {% endif %}
  {% endfor %}
</div>
