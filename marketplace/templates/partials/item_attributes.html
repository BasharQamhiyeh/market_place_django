{# ✅ COPY-PASTE REPLACE: templates/partials/item_attributes.html #}
{% load form_extras %}

<div id="attrsRoot" class="space-y-4">
  {% for field in form %}
    {% if field.name|slice:":5" == "attr_" and field.name|slice:"-6:" != "_other" %}

      <div class="attr-block mb-3" data-field-name="{{ field.html_name }}">

        <label class="label">{{ field.label }}</label>

        {# ================= TEXT / NUMBER ================= #}
        {% if field.field.widget.input_type == "text" or field.field.widget.input_type == "number" %}
          {{ field }}

        {# ================= RADIO (MOCKUP STYLE) ================= #}
        {% elif field.field.widget.input_type == "radio" %}
          <div class="grid grid-cols-1 sm:grid-cols-2 gap-3 mt-2">
            {% for value,label in field.field.choices %}
              {% if value %}
                {# ✅ IMPORTANT: removed border-gray-200 so .elect-card:has(input:checked) wins #}
                <label class="elect-card flex items-center gap-2 border border-orange-200 rounded-xl p-3 cursor-pointer bg-white">
                  <input type="radio"
                         name="{{ field.html_name }}"
                         value="{{ value }}"
                         {% if field.value|stringformat:"s" == value|stringformat:"s" %}checked{% endif %}>
                  <span class="font-semibold text-sm">{{ label }}</span>
                </label>
              {% endif %}
            {% endfor %}
          </div>

        {# ================= CHECKBOX LIST ================= #}
        {% elif field.field.widget.input_type == "checkbox" and field.field.widget.allow_multiple_selected %}
          <div class="grid grid-cols-1 sm:grid-cols-2 gap-3 mt-2">
            {% for value,label in field.field.choices %}
              {% if value %}
                {# ✅ IMPORTANT: removed border-gray-200 so .elect-card:has(input:checked) wins #}
                <label class="elect-card flex items-center gap-2 border rounded-xl p-3 cursor-pointer bg-white">
                  <input type="checkbox"
                         name="{{ field.html_name }}"
                         value="{{ value }}"
                         {% if field.value and value in field.value %}checked{% endif %}>
                  <span class="font-semibold text-sm">{{ label }}</span>
                </label>
              {% endif %}
            {% endfor %}
          </div>

        {# ================= DROPDOWN ================= #}
        {% elif field.field.widget.input_type == "select" %}
          {{ field }}

        {% else %}
          {{ field }}
        {% endif %}

        {% if field.errors %}
          <p class="field-error">{{ field.errors }}</p>
        {% endif %}

        {# ================= OTHER FIELD (ALWAYS RENDERED, HIDDEN) ================= #}
        {% with other_name=field.name|add:"_other" %}
          {% if other_name in form.fields %}
            {% with other_field=form|getitem:other_name %}
              <div class="other-wrapper mt-2" style="display:none;">
                <label class="label">{{ other_field.label }}</label>
                {{ other_field }}
              </div>
            {% endwith %}
          {% endif %}
        {% endwith %}

      </div>

    {% endif %}
  {% endfor %}
</div>
