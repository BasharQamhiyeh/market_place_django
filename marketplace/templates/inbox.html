{% extends 'base.html' %}
{% load i18n %}

{% block title %}{% trans "My Conversations" %}{% endblock %}

{% block content %}

<div class="bg-white border border-gray-200 rounded-xl shadow">

  <div class="px-5 py-3 bg-gray-900 text-white rounded-t-xl">
    <h5 class="text-lg font-semibold mb-0">{% trans "My Conversations" %}</h5>
  </div>

  <div class="p-6">

    {% if convos %}
      <div class="space-y-3">

        {% for convo in convos %}
          {% with listing=convo.listing item=listing.item request_obj=listing.request %}

          <a href="{% url 'chat_room' convo.id %}"
             class="
              block px-4 py-3 rounded-lg transition shadow-sm
              {% if item %}
                  bg-[var(--rukn-orange-light)] border-l-4 border-[var(--rukn-orange)]
              {% else %}
                  bg-[var(--rukn-green-50)] border-l-4 border-[var(--rukn-green)]
              {% endif %}
          ">

            <div class="flex justify-between items-center">
              <div>
                <div class="font-semibold text-gray-900">

                  {% if item %}
                    {% trans "Conversation about" %} “{{ item.listing.title }}”
                  {% elif request_obj %}
                    {% trans "Conversation about" %} “{{ request_obj.listing.title }}”
                  {% endif %}

                </div>

                <div class="text-gray-600 text-sm mt-1">
                  {% trans "With" %}:
                  {% if request.user == convo.buyer %}
                    {{ convo.seller.username }}
                  {% else %}
                    {{ convo.buyer.username }}
                  {% endif %}
                </div>
              </div>

              <span class="px-3 py-1 text-xs bg-gray-200 text-gray-800 rounded-full">
                {{ convo.created_at|timesince }} {% trans "ago" %}
              </span>
            </div>

          </a>

          {% endwith %}
        {% endfor %}

      </div>

    {% else %}
      <div class="bg-blue-50 text-blue-800 px-4 py-3 rounded">
        {% trans "No conversations yet." %}
      </div>
    {% endif %}

  </div>

</div>

{% endblock %}
