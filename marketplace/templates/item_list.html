{% extends "base.html" %}
{% load i18n %}

{% block title %}{% trans "Browse items" %}{% endblock %}

{% block content %}
<div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 mt-6 mb-10">
  <div class="flex flex-col lg:flex-row gap-6">

    {# ================= FILTERS (LEFT) ================= #}
    <aside class="w-full lg:w-72 bg-white border border-gray-200 rounded-2xl p-4 shadow-sm">
      <h2 class="text-sm font-semibold mb-3">
        {% trans "Filter" %}
      </h2>

      <form method="get" action="{% url 'item_list' %}" class="space-y-4">
        {# keep current search text in filters #}
        <input type="hidden" name="q" value="{{ q }}">

        {# CATEGORIES (multi-select) #}
        <div>
          <p class="text-xs font-medium text-gray-500 mb-1">
            {% trans "Categories" %}
          </p>
          <div class="space-y-2 max-h-64 overflow-y-auto text-xs">
            {% for cat in categories %}
              <label class="flex items-center gap-2 text-gray-700">
                <input
                  type="checkbox"
                  name="categories"
                  value="{{ cat.id }}"
                  class="rounded border-gray-300 text-[var(--rukn-orange)] focus:ring-[var(--rukn-orange)]"
                  {% if cat.id|stringformat:"s" in selected_categories %}checked{% endif %}
                >
                <span>{{ cat }}</span>
              </label>

              {# show subcategories indented if you want #}
              {% for sub in cat.subcategories.all %}
                <label class="flex items-center gap-2 text-gray-500 ms-4">
                  <input
                    type="checkbox"
                    name="categories"
                    value="{{ sub.id }}"
                    class="rounded border-gray-300 text-[var(--rukn-orange)] focus:ring-[var(--rukn-orange)]"
                    {% if sub.id|stringformat:"s" in selected_categories %}checked{% endif %}
                  >
                  <span class="text-[0.8rem]">â€“ {{ sub }}</span>
                </label>
              {% endfor %}
            {% endfor %}
          </div>
        </div>

        {# CITY #}
        <div>
          <p class="text-xs font-medium text-gray-500 mb-1">
            {% trans "City" %}
          </p>
          <select
            name="city"
            class="w-full rounded-lg border border-gray-300 text-xs py-1.5 focus:ring-[var(--rukn-orange)] focus:border-[var(--rukn-orange)]"
          >
            <option value="">{% trans "All cities" %}</option>
            {% for city in cities %}
              <option value="{{ city.id }}"
                      {% if city.id|stringformat:"s" == request.GET.city %}selected{% endif %}>
                {{ city.name_ar }}
              </option>
            {% endfor %}
          </select>
        </div>

        {# PRICE RANGE #}
        <div>
          <p class="text-xs font-medium text-gray-500 mb-1">
            {% trans "Price (JOD)" %}
          </p>
          <div class="grid grid-cols-2 gap-2">
            <input
              type="number"
              name="min_price"
              value="{{ request.GET.min_price }}"
              placeholder="{% trans 'Min' %}"
              class="w-full rounded-lg border border-gray-300 text-xs py-1.5 px-2 focus:ring-[var(--rukn-orange)] focus:border-[var(--rukn-orange)]"
            >
            <input
              type="number"
              name="max_price"
              value="{{ request.GET.max_price }}"
              placeholder="{% trans 'Max' %}"
              class="w-full rounded-lg border border-gray-300 text-xs py-1.5 px-2 focus:ring-[var(--rukn-orange)] focus:border-[var(--rukn-orange)]"
            >
          </div>
        </div>

        <button
          type="submit"
          class="w-full mt-2 rounded-full bg-[var(--rukn-orange)] text-white text-xs font-semibold py-2 shadow-sm hover:brightness-110 transition"
        >
          {% trans "Apply filters" %}
        </button>
      </form>
    </aside>

    {# ================= RESULTS (RIGHT) ================= #}
    <section class="flex-1">
      <div class="flex items-center justify-between mb-3">
        <h1 class="text-lg md:text-xl font-bold">
          {% trans "Items" %}
        </h1>
        {% if q %}
          <p class="text-xs text-gray-500">
            {% blocktrans %}Results for "{{ q }}"{% endblocktrans %}
          </p>
        {% endif %}
      </div>

      <div id="results">
        {# This uses page_obj from the view and the old working design #}
        {% include "partials/item_results.html" %}
      </div>
    </section>

  </div>
</div>
{% endblock %}
