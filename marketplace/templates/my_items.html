{% extends 'base.html' %}
{% load i18n %}

{% block title %}{% trans "My Items" %}{% endblock %}

{% block content %}
<h2>{% trans "My Items" %}</h2>

<p style="margin:8px 0 16px;">
  <a href="{% url 'create_item' %}">{% trans "Post new item" %}</a>
</p>

{% if page_obj.object_list %}
  <div style="display:grid; gap:16px;">
    {% for item in page_obj.object_list %}
      <div style="display:flex; gap:12px; align-items:flex-start; border:1px solid #e5e5e5; padding:10px; border-radius:8px;">
        {% with first_photo=item.photos.first %}
          {% if first_photo %}
            <img src="{{ first_photo.image.url }}" alt="{{ item.title }}" width="100" height="100" style="object-fit:cover;border-radius:6px;">
          {% endif %}
        {% endwith %}

        <div style="flex:1;">
          <h3 style="margin:0 0 6px;">
            <a href="{% url 'item_detail' item.id %}">{{ item.title }}</a>
          </h3>

          <div style="font-size:14px; color:#555;">
            {% trans "Price" %}: {{ item.price }} |
            {% trans "Created" %}: {{ item.created_at|date:"Y-m-d H:i" }} |
            {% trans "Updated" %}: {{ item.updated_at|date:"Y-m-d H:i" }}
          </div>

          <div style="margin-top:6px;">
            {% if item.is_active and item.is_approved %}
              <span style="padding:2px 8px;background:#e8f7ee;color:#1f7a4d;border-radius:999px;font-size:12px;">{% trans "Active" %}</span>
            {% elif item.is_active and not item.is_approved %}
              <span style="padding:2px 8px;background:#fff7e6;color:#b26b00;border-radius:999px;font-size:12px;">{% trans "Pending approval" %}</span>
            {% else %}
              <span style="padding:2px 8px;background:#f3f4f6;color:#374151;border-radius:999px;font-size:12px;">{% trans "Inactive" %}</span>
            {% endif %}
          </div>

          <div style="margin-top:8px; display:flex; gap:10px; flex-wrap:wrap;">
            <a href="{% url 'item_detail' item.id %}">{% trans "View" %}</a>
            <a href="{% url 'item_edit' item.id %}">{% trans "Edit" %}</a>

            {% if item.is_active %}
              <a href="{% url 'cancel_item' item.id %}" style="color:#dc3545;">
                {% trans "Cancel Ad" %}
              </a>
            {% endif %}

            {% if not item.is_active %}
              <form action="{% url 'reactivate_item' item.id %}" method="post" style="display:inline;">
                {% csrf_token %}
                <button type="submit" style="background:#0ea5e9;color:#fff;border:none;padding:4px 8px;border-radius:6px;cursor:pointer;">
                  {% trans "Reactivate" %}
                </button>
              </form>
            {% endif %}
          </div>
        </div>
      </div>
    {% endfor %}
  </div>

  <!-- Pagination -->
  <div style="margin-top:16px; display:flex; gap:8px; align-items:center;">
    {% if page_obj.has_previous %}
      <a href="?page={{ page_obj.previous_page_number }}{% if q %}&q={{ q|urlencode }}{% endif %}">&laquo; {% trans "Prev" %}</a>
    {% endif %}
    <span>{% trans "Page" %} {{ page_obj.number }} {% trans "of" %} {{ page_obj.paginator.num_pages }}</span>
    {% if page_obj.has_next %}
      <a href="?page={{ page_obj.next_page_number }}{% if q %}&q={{ q|urlencode }}{% endif %}">{% trans "Next" %} &raquo;</a>
    {% endif %}
  </div>

{% else %}
  <p>{% trans "You haven't posted any items yet." %}</p>
{% endif %}

{% endblock %}
