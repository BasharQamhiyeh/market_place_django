{% extends 'base.html' %}
{% load i18n %}

{% block title %}{% trans "My Announcements" %}{% endblock %}

{% block content %}
<div class="bg-white border border-gray-200 shadow rounded-xl">
  <!-- Header -->
  <div class="bg-gray-900 text-white px-5 py-3 rounded-t-xl flex justify-between items-center">
    <h5 class="text-lg font-semibold">{% trans "My Announcements" %}</h5>

    <a href="{% url 'create_item' %}"
       class="bg-jordan text-white text-sm px-3 py-2 rounded hover:opacity-90">
      {% trans "New Announcement" %}
    </a>
  </div>

  <!-- Body -->
  <div class="p-6">

    {% if page_obj.object_list %}
      <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
        {% for item in page_obj.object_list %}
          <div class="bg-white border border-gray-200 rounded-xl shadow-sm flex flex-col">

            {% with first_photo=item.photos.first %}
              {% if first_photo %}
                <img src="{{ first_photo.image.url }}"
                     alt="{{ item.title }}"
                     class="w-full rounded-t-xl"
                     style="height:180px; object-fit:cover;">
              {% endif %}
            {% endwith %}

            <div class="p-4 flex-1">
              <h6 class="text-base font-semibold mb-1">
                <a href="{% url 'item_detail' item.id %}"
                   class="text-gray-900 hover:text-jordan">
                  {{ item.title }}
                </a>
              </h6>

              <div class="text-gray-500 text-sm mb-2">
                {% trans "Price" %}: {{ item.price }} ·
                {% trans "Created" %}: {{ item.created_at|date:"Y-m-d H:i" }} ·
                {% trans "Updated" %}: {{ item.updated_at|date:"Y-m-d H:i" }}
              </div>

              <!-- Status badge -->
              <div>
                {% if item.is_active and item.is_approved %}
                  <span class="px-3 py-1 text-xs rounded-full bg-green-100 text-green-700">
                    {% trans "Active" %}
                  </span>
                {% elif item.is_active and not item.is_approved %}
                  <span class="px-3 py-1 text-xs rounded-full bg-yellow-200 text-yellow-800">
                    {% trans "Pending approval" %}
                  </span>
                {% else %}
                  <span class="px-3 py-1 text-xs rounded-full bg-gray-200 text-gray-700">
                    {% trans "Inactive" %}
                  </span>
                {% endif %}
              </div>
            </div>

            <!-- Footer buttons -->
            <div class="px-4 py-3 bg-gray-50 rounded-b-xl flex flex-wrap gap-2">
              <a href="{% url 'item_detail' item.id %}"
                 class="px-3 py-1.5 text-sm rounded border border-gray-300 text-gray-700 hover:bg-gray-100">
                {% trans "View" %}
              </a>

              <a href="{% url 'item_edit' item.id %}"
                 class="px-3 py-1.5 text-sm rounded bg-gray-700 text-white hover:opacity-90">
                {% trans "Edit" %}
              </a>

              {% if item.is_active %}
                <a href="{% url 'cancel_item' item.id %}"
                   class="px-3 py-1.5 text-sm rounded bg-red-600 text-white hover:bg-red-700">
                  {% trans "Cancel" %}
                </a>
              {% endif %}

              {% if not item.is_active %}
                <form action="{% url 'reactivate_item' item.id %}" method="post" class="inline">
                  {% csrf_token %}
                  <button type="submit"
                    class="px-3 py-1.5 text-sm rounded bg-blue-500 text-white hover:bg-blue-600">
                    {% trans "Reactivate" %}
                  </button>
                </form>
              {% endif %}
            </div>

          </div>
        {% endfor %}
      </div>

      <!-- Pagination -->
      <nav class="mt-6 flex justify-center items-center gap-4">
        {% if page_obj.has_previous %}
          <a class="px-3 py-1.5 text-sm border border-gray-300 rounded hover:bg-gray-100"
             href="?page={{ page_obj.previous_page_number }}{% if q %}&q={{ q|urlencode }}{% endif %}">
            &laquo; {% trans "Prev" %}
          </a>
        {% endif %}

        <span class="text-gray-500 text-sm">
          {% trans "Page" %} {{ page_obj.number }} {% trans "of" %} {{ page_obj.paginator.num_pages }}
        </span>

        {% if page_obj.has_next %}
          <a class="px-3 py-1.5 text-sm border border-gray-300 rounded hover:bg-gray-100"
             href="?page={{ page_obj.next_page_number }}{% if q %}&q={{ q|urlencode }}{% endif %}">
            {% trans "Next" %} &raquo;
          </a>
        {% endif %}
      </nav>

    {% else %}
      <div class="bg-blue-50 text-blue-800 px-4 py-3 rounded">
        {% trans "You haven't posted any announcement yet." %}
      </div>
    {% endif %}
  </div>
</div>
{% endblock %}
