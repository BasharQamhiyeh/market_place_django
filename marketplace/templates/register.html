{% extends "base.html" %}
{% load static %}

{% block title %}ุฑูู โ ุฅูุดุงุก ุญุณุงุจ{% endblock %}

{% block base_css %}
<link rel="stylesheet" href="{% static 'css/signup.css' %}">
{% endblock %}

{% block content %}
<div class="min-h-screen flex items-center justify-center px-4">
  <div id="signupContainer" class="auth-card w-full">

    <div class="auth-header">
      <div class="flex justify-center items-center pb-8">
        <img
          src="https://iili.io/fo9Iynj.png"
          alt="ุดุนุงุฑ ุฑูู"
          class="h-12 w-auto object-contain"
        />
      </div>

      <h1 class="auth-title">ุฅูุดุงุก ุญุณุงุจ ูู ุฑูู</h1>
      <p class="auth-subtitle">ุณุฌูู ูุนูุง ูููุตูู ุฅูู ุฌููุน ุฎุฏูุงุช ุงูููุตุฉ</p>
    </div>

    <!-- STEP 1: Mobile -->
    <form id="mobileForm">
      {% csrf_token %}
      <label class="label">ุฃุฏุฎู ุฑูู ุงูููุจุงูู ุงูุฎุงุต ุจู</label>
      <input
        type="text"
        id="mobile"
        inputmode="numeric"
        maxlength="10"
        class="input-field text-right placeholder:text-right"
        placeholder="ูุซุงู: 0790000000"
      >
      <div id="mobileErr"></div>

      <button id="sendOtpBtn" type="submit" class="submit-btn text-base block">
        ุฅุฑุณุงู ุฑูุฒ ุงูุชุญูู
      </button>
    </form>

    <!-- STEP 3: Full signup (hidden until verified) -->
    <form id="signupForm" class="space-y-6 hidden mt-4"
          method="post" action="{% url 'complete_signup' %}">
      {% csrf_token %}

      <!-- Verified phone stored here -->
      <input type="hidden" id="verifiedMobile" name="verifiedMobile">

      <div class="flex flex-col md:flex-row gap-6">
        <div class="flex-1">
          <label class="label">ุงูุงุณู ุงูุฃูู *</label>
          <input type="text" id="firstName" name="first_name" class="input-field" placeholder="ูุซุงู: ุฃุญูุฏ">
          <div id="firstNameErr"></div>
        </div>

        <div class="flex-1">
          <label class="label">ุงูุงุณู ุงูุฃุฎูุฑ *</label>
          <input type="text" id="lastName" name="last_name" class="input-field" placeholder="ูุซุงู: ุงูุฃุญูุฏ">
          <div id="lastNameErr"></div>
        </div>
      </div>

      <!-- Account type (UI only for now) -->
      <div class="mt-2">
        <label class="label">ููุน ุงูุญุณุงุจ *</label>

        <div id="conditionBox"
             class="flex border border-gray-200 shadow-sm bg-white overflow-hidden rounded-lg w-full">
          <button id="btnPersonal" type="button"
            class="flex-1 py-2.5 text-sm font-bold toggle-active bg-[var(--rukn-orange)] text-white">
            ูุฑุฏ
          </button>

          <button id="btnStore" type="button"
            class="flex-1 py-2.5 text-sm font-bold text-[var(--muted)] bg-white">
            ุชุงุฌุฑ
          </button>
        </div>

        <input type="hidden" id="conditionValue" value="personal">
      </div>

      <!-- Store box (UI only for now) -->
      <div id="storeBox" class="hidden mt-4 rounded-2xl shadow-lg overflow-hidden">
        <div class="bg-[var(--rukn-orange)] text-white px-5 py-3 flex items-center gap-2">
          <h3 class="font-bold text-lg">ุจูุงูุงุช ุงููุชุฌุฑ</h3>
        </div>

        <div class="bg-white p-6 space-y-5">
          <div>
            <label class="label">ุงุณู ุงููุชุฌุฑ *</label>
            <input type="text" id="storeName" class="input-field" placeholder="ูุซุงู: ูุชุฌุฑ ุงููููุฏ">
            <div id="storeNameErr"></div>
          </div>

          <div>
            <label class="label">ููุฌู ุงููุชุฌุฑ (ุงุฎุชูุงุฑู)</label>

            <div class="flex items-center gap-4 mt-2">
              <div class="relative w-24 h-24 rounded-3xl bg-gray-50 border border-gray-200 shadow-sm flex items-center justify-center overflow-hidden">
                <button id="removeLogo" type="button"
                  class="submit-btn hidden absolute top-1 right-1 bg-white text-red-600 border border-red-400 rounded-full w-6 h-6 flex items-center justify-center text-xs font-bold shadow">
                  โ
                </button>

                <img id="logoPreview" class="w-full h-full hidden" alt="logo">
                <span id="logoPlaceholder" class="text-4xl text-gray-400">๐ท</span>
              </div>

              <label for="storeLogo"
                class="cursor-pointer bg-[var(--rukn-orange)] text-white px-4 py-2 rounded-lg font-semibold text-sm hover:bg-[#e56a00] transition">
                ุงุฎุชุฑ ุตูุฑุฉ
              </label>

              <input type="file" id="storeLogo" accept="image/*" class="hidden">
            </div>

            <div id="storeLogoErr"></div>
          </div>
        </div>
      </div>

      <!-- Passwords -->
      <div class="flex flex-col md:flex-row gap-6">
        <div class="flex-1">
          <label class="label mt-2">ูููุฉ ุงููุฑูุฑ *</label>
          <div class="relative">
            <input type="password" id="pass1" name="password" class="input-field" placeholder="********">
            <button type="button" id="togglePass1"
              class="absolute top-1/2 -translate-y-1/2 left-4 text-gray-500"></button>
          </div>
          <div id="pass1Err"></div>
        </div>

        <div class="flex-1">
          <label class="label mt-2">ุชุฃููุฏ ูููุฉ ุงููุฑูุฑ *</label>
          <div class="relative">
            <input type="password" id="pass2" name="password2" class="input-field" placeholder="********">
            <button type="button" id="togglePass2"
              class="absolute top-1/2 -translate-y-1/2 left-4 text-gray-500"></button>
          </div>
          <div id="pass2Err"></div>
        </div>
      </div>

      <!-- Terms -->
      <div class="mt-2 flex items-start gap-3 select-none">
        <input type="checkbox" id="acceptTerms" class="checkbox-large mt-1">
        <span class="text-sm text-gray-700 leading-relaxed">
          ุฃูุงูู ุนูู
          <button type="button" id="termsLink"
                  class="text-[var(--rukn-orange)] font-semibold hover:underline">
            ุงูุดุฑูุท ูุงูุฃุญูุงู
          </button>
          ู
          <button type="button" id="privacyLink"
                  class="text-[var(--rukn-orange)] font-semibold hover:underline">
            ุณูุงุณุฉ ุงูุฎุตูุตูุฉ
          </button>
        </span>
      </div>
      <div id="acceptTermsErr"></div>

      <button type="submit" class="submit-btn mt-2 px-10 py-3 text-base w-full">
        ุฅูุดุงุก ุงูุญุณุงุจ
      </button>
    </form>
  </div>
</div>

<!-- OTP success popup -->
<div id="otpSuccessPopup" class="success-popup-bg hidden" style="z-index:9999;">
  <div class="success-popup">
    <div class="flex flex-col items-center mb-3">
      <div class="w-14 h-14 rounded-2xl bg-orange-50 flex items-center justify-center text-[var(--rukn-orange)] text-3xl mb-2">
        โ
      </div>
      <h2 class="text-lg font-extrabold text-gray-900">ุชู ุงูุชุญูู ุจูุฌุงุญ</h2>
      <p class="text-sm text-gray-500 text-center">ุฌุงุฑู ุงูุงูุชูุงู ุฅูู ูููุฐุฌ ุฅูุดุงุก ุงูุญุณุงุจ...</p>
    </div>
  </div>
</div>

<!-- Verify popup -->
<div id="verifyPopup" class="popup-bg hidden">
  <div class="popup-box">

    <div class="flex items-center justify-center gap-3 mb-4">
      <div class="w-10 h-10 rounded-2xl bg-orange-100 flex items-center justify-center text-[var(--rukn-orange)] text-2xl">
        ๐
      </div>
      <div class="text-right">
        <h2 class="text-lg font-extrabold text-gray-900">ุชุฃููุฏ ุฑูู ุงูููุจุงูู</h2>
        <p class="text-xs text-gray-500 mt-1">ุฃุฏุฎู ุฑูุฒ ุงูุชุญูู ุงูููููู ูู 4 ุฃุฑูุงู ูุฅุชูุงู ุฅูุดุงุก ุงูุญุณุงุจ</p>
      </div>
    </div>

    <label class="label text-sm mt-2">ุฑูุฒ ุงูุชุญูู *</label>
    <input type="text" id="verifyCodeInput" inputmode="numeric" maxlength="4"
           class="input-field font-bold text-2xl mb-1 text-center tracking-[0.4em]"
           placeholder="0 0 0 0">
    <div id="verifyCodeErr"></div>

    <div class="flex gap-3 mt-5">
      <!-- โ IMPORTANT: type="button" -->
      <button id="checkVerifyCode" type="button"
        class="flex-1 py-3 rounded-xl font-bold bg-[var(--rukn-orange)] text-white hover:bg-[#e56a00] transition duration-200 shadow-md">
        ุชุญูู ุงูุขู
      </button>

      <!-- โ IMPORTANT: type="button" -->
      <button id="closeVerify" type="button"
        class="flex-1 py-3 rounded-xl font-semibold bg-gray-100 text-gray-700 border border-gray-300 hover:bg-gray-200 transition duration-200">
        ุฅูุบุงุก
      </button>
    </div>
  </div>
</div>

<!-- Success popup (optional, kept like mockup) -->
<div id="successPopup" class="success-popup-bg hidden">
  <div class="success-popup">
    <div class="flex flex-col items-center mb-4">
      <div class="w-14 h-14 rounded-2xl bg-orange-50 flex items-center justify-center text-[var(--rukn-orange)] text-3xl mb-3">
        โ
      </div>
      <h2 class="text-lg font-extrabold text-gray-900 mb-1">ุชู ุฅูุดุงุก ุงูุญุณุงุจ ุจูุฌุงุญ</h2>
      <p class="text-sm text-gray-500 text-center leading-relaxed">
        ุชู ุฅูุดุงุก ุญุณุงุจู ุงูุฌุฏูุฏ ุจูุฌุงุญ. ููููู ุงูุขู ุชุณุฌูู ุงูุฏุฎูู ูุงูุจุฏุก ุจุงุณุชุฎุฏุงู ููุตุฉ ุฑูู.
      </p>
    </div>

    <button id="closeSuccess" type="button"
      class="w-full mt-2 bg-[var(--rukn-orange)] text-white py-3 rounded-xl font-bold hover:bg-[#e56a00] transition duration-200 shadow-md">
      ุญุณูุงู
    </button>
  </div>
</div>

<!-- Terms popup -->
<div id="termsPopup" class="popup-bg hidden">
  <div class="popup-box">
    <h2 class="text-lg font-bold text-[var(--rukn-orange)] mb-4 text-center">ุงูุดุฑูุท ูุงูุฃุญูุงู</h2>
    <div class="popup-content text-sm leading-relaxed text-gray-800">
      <p>...</p>
    </div>
    <button id="closeTerms" type="button"
      class="w-full mt-4 bg-[var(--rukn-orange)] text-white py-3 rounded-xl font-bold hover:bg-[#e56a00] transition">
      ุฅุบูุงู
    </button>
  </div>
</div>

<!-- Privacy popup -->
<div id="privacyPopup" class="popup-bg hidden">
  <div class="popup-box max-h-[80vh]">
    <h2 class="text-lg font-bold text-[var(--rukn-orange)] mb-3 text-center">ุณูุงุณุฉ ุงูุฎุตูุตูุฉ</h2>
    <div class="popup-content text-sm leading-relaxed text-gray-800">
      <p>...</p>
    </div>
    <button id="closePrivacy" type="button"
      class="w-full mt-4 bg-[var(--rukn-orange)] text-white py-3 rounded-xl font-bold hover:bg-[#e56a00] transition">
      ุฅุบูุงู
    </button>
  </div>
</div>
{% endblock %}

{% block scripts %}
{{ block.super }}
<script>
  window.SIGNUP_SEND_OTP_URL = "{% url 'ajax_send_signup_otp' %}";
  window.SIGNUP_VERIFY_OTP_URL = "{% url 'ajax_verify_signup_otp' %}";
</script>
<script src="{% static 'js/signup_django.js' %}" defer></script>
{% endblock %}
