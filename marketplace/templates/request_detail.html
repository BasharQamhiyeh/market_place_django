{% extends "base.html" %}
{% load static i18n %}

{% block title %}Ø±ÙƒÙ† â€” Ø¹Ø±Ø¶ Ø§Ù„Ø·Ù„Ø¨{% endblock %}

{% block base_css %}
  {{ block.super }}
  <link rel="stylesheet" href="{% static 'css/view-request.css' %}">
{% endblock %}

{% block content %}

<div class="px-4 sm:px-0" data-auth="{% if request.user.is_authenticated %}1{% else %}0{% endif %}">
  <div class="min-h-screen flex flex-col py-8 lg:py-12">

    <!-- Header -->
    <header class="max-w-screen-xl mx-auto w-full mb-4 sm:px-4">
      <div class="flex flex-col gap-3">
        <nav class="text-sm text-[var(--muted)] mt-1">
          <a href="{% url 'home' %}" class="hover:text-[var(--rukn-green)]">Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</a> /
          <a href="{% url 'request_list' %}" class="hover:text-[var(--rukn-green)]">Ø§Ù„Ø·Ù„Ø¨Ø§Øª</a> /

          {% if breadcrumb_categories %}
            {% for cat in breadcrumb_categories %}
              <a href="{% url 'request_list' %}?categories={{ cat.id }}" class="hover:text-[var(--rukn-green)]">
                <bdi dir="auto">
                  {% if LANGUAGE_CODE == "ar" %}{{ cat.name_ar }}{% else %}{{ cat.name_en }}{% endif %}
                </bdi>
              </a>
              /
            {% endfor %}
          {% endif %}

          <span class="text-gray-600">
            <bdi dir="auto">{{ request_obj.listing.title }}</bdi>
          </span>

        </nav>
      </div>
    </header>

    <!-- MAIN -->
    <main class="max-w-screen-xl mx-auto mt-2 mb-6 w-full sm:px-4">
      <div class="flex flex-col lg:flex-row lg:gap-2">

        <!-- Right 70% -->
        <section class="w-full lg:w-[70%] lg:order-1 space-y-5 lg:pe-2">

          <div class="container-box z-10">

            <!-- Info -->
            <div class="p-5 sm:p-6 border-b-2 border-gray-200">
              <div class="flex flex-col gap-3">
                <div class="flex items-start justify-between gap-3">
                  <div class="flex-1">

                    <h2 class="text-lg md:text-xl font-extrabold text-slate-900 leading-snug">
                      {{ request_obj.listing.title }}
                    </h2>
                  </div>

                  {% if request_obj.budget %}
                  <div class="flex flex-col items-center gap-1 min-w-[80px]">
                    <span class="text-[11px] font-semibold text-gray-500">Ø£Ù‚ØµÙ‰ Ù…ÙŠØ²Ø§Ù†ÙŠØ©</span>
                    <div class="text-center">
                      <div class="text-[30px] md:text-[34px] font-extrabold text-[var(--rukn-green)] leading-none">
                        {{ request_obj.budget|floatformat:0 }}
                      </div>
                      <div class="text-[12px] font-semibold text-gray-700 mt-1">Ø¯ÙŠÙ†Ø§Ø± Ø£Ø±Ø¯Ù†ÙŠ</div>
                    </div>
                  </div>
                  {% endif %}
                </div>

                <!-- Meta pills -->
                <div class="flex flex-wrap gap-2 text-[11px] sm:text-xs mt-1">

                  <button type="button"
                          onclick="copyAdNumber()"
                          class="meta-pill hover:border-green-200 hover:bg-green-50 transition">
                    <span class="meta-icon text-green-600">
                      <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14"
                           viewBox="0 0 24 24" fill="none" stroke="currentColor"
                           stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <line x1="4" x2="20" y1="9" y2="9" />
                        <line x1="4" x2="20" y1="15" y2="15" />
                        <line x1="10" x2="8" y1="3" y2="21" />
                        <line x1="16" x2="14" y1="3" y2="21" />
                      </svg>
                    </span>
                    <span>Ø±Ù‚Ù… Ø§Ù„Ø·Ù„Ø¨: <strong id="adNumber">{{ request_obj.id }}</strong></span>
                  </button>

                  <span class="meta-pill">
                    <span class="meta-icon">
                      <svg class="w-3.5 h-3.5 text-green-600" viewBox="0 0 20 20" fill="none">
                        <rect x="3" y="4" width="14" height="13" rx="2" stroke="currentColor" stroke-width="1.6" />
                        <path d="M7 2v4M13 2v4M4 8h12" stroke="currentColor" stroke-width="1.6" stroke-linecap="round" />
                      </svg>
                    </span>
                    <span>ØªØ§Ø±ÙŠØ® Ø§Ù„Ù†Ø´Ø±: {{ request_obj.listing.created_at|date:"Y/m/d" }}</span>
                  </span>

                  <span class="meta-pill">
                    <span class="meta-icon">
                      <svg class="w-3.5 h-3.5 text-green-600" viewBox="0 0 20 20" fill="none">
                        <path d="M10 18s6-5.05 6-10a6 6 0 1 0-12 0c0 4.95 6 10 6 10z"
                              stroke="currentColor" stroke-width="1.6" stroke-linejoin="round" />
                        <circle cx="10" cy="8" r="2.3" stroke="currentColor" stroke-width="1.6" />
                      </svg>
                    </span>
                    <span>{% if request_obj.listing.city %}{{ request_obj.listing.city }}{% else %}â€”{% endif %}</span>
                  </span>

                  <span class="meta-pill">
                    <span class="meta-icon">
                      <svg class="w-3.5 h-3.5 text-green-600" viewBox="0 0 20 20" fill="none">
                        <path d="M10 2L5 11h4l-1 7 7-10h-4l3-6h-4z"
                              stroke="currentColor" stroke-width="1.6" stroke-linejoin="round" />
                      </svg>
                    </span>
                    <span>
                      {% if request_obj.condition == "new" %}
                        Ø¬Ø¯ÙŠØ¯
                      {% elif request_obj.condition == "used" %}
                        Ù…Ø³ØªØ¹Ù…Ù„
                      {% else %}
                        Ù„Ø§ ÙŠÙ‡Ù…
                      {% endif %}
                    </span>
                  </span>
                </div>
              </div>
            </div>

            <!-- Details + Attributes -->
            <div class="border-t-2 border-[var(--rukn-gray)] p-5 sm:p-6 border-b-2 border-gray-200">

              <div class="flex-1">
                <div class="flex items-center gap-2 mb-3">
                  <span class="w-6 h-6 rounded-full bg-green-50 text-[var(--rukn-green)] flex items-center justify-center text-base">
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16"
                         viewBox="0 0 24 24" fill="none" stroke="currentColor"
                         stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                      <path d="M14 2v4a2 2 0 0 0 2 2h4" />
                      <path d="M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7z" />
                      <path d="M10 13l2 2 4-4" />
                    </svg>
                  </span>
                  <h3 class="text-lg text-[var(--rukn-green)] font-bold">ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø·Ù„Ø¨</h3>
                </div>

                <div class="text-sm text-gray-700 leading-relaxed space-y-3 px-8">
                  {% if request_obj.listing.description %}
                    {{ request_obj.listing.description|linebreaks }}
                  {% else %}
                    <p class="text-[var(--muted)]">Ù„Ø§ ÙŠÙˆØ¬Ø¯ ØªÙØ§ØµÙŠÙ„.</p>
                  {% endif %}
                </div>
              </div>

              {% if attributes %}
              <div class="mb-8 pt-8">
                <h3 class="text-lg font-bold text-gray-800 mb-4 flex items-center gap-2">
                  <span class="w-6 h-6 rounded-full bg-green-50 text-[var(--rukn-green)] flex items-center justify-center text-base">
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16"
                         viewBox="0 0 24 24" fill="none" stroke="currentColor"
                         stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                      <circle cx="12" cy="12" r="10" />
                      <path d="M12 16v-4" />
                      <path d="M12 8h.01" />
                    </svg>
                  </span>
                  <span class="text-[var(--rukn-green)]">Ù…ÙˆØ§ØµÙØ§Øª Ù…ÙØ¶Ù„Ø©</span>
                </h3>

                <div class="grid grid-cols-2 md:grid-cols-4 gap-3 px-8">
                  {% for a in attributes %}
                    <div class="bg-gray-50 border border-gray-200 rounded-2xl p-3 text-center transition hover:border-[var(--rukn-green)]">
                      <span class="block text-[10px] text-gray-500 mb-1">{{ a.attribute.name }}</span>
                      <span class="font-bold text-gray-900 text-sm">{{ a.value }}</span>
                    </div>
                  {% endfor %}
                </div>
              </div>
              {% endif %}
            </div>
          </div>

          <!-- Safety tips -->
          <div class="container-box p-5 sm:p-6">
            <div class="relative z-10">
              <div class="flex items-center gap-2 mb-3">
                <span class="text-xl">ğŸ›¡ï¸</span>
                <h3 class="text-lg font-bold text-gray-800">Ù†ØµØ§Ø¦Ø­ ÙˆØªØ°ÙƒÙŠØ±Ø§Øª Ù„Ù„Ø£Ù…Ø§Ù†</h3>
              </div>
              <div class="grid grid-cols-1 md:grid-cols-3 gap-3 text-xs sm:text-sm text-[var(--muted)]">
                <div class="bg-gray-50 border border-gray-200 rounded-2xl p-3 flex gap-3 items-start">
                  <span class="text-lg">ğŸ‘¥</span>
                  <p>Ø±ØªÙ‘Ø¨ Ù„Ù‚Ø§Ø¡ ÙÙŠ Ù…ÙƒØ§Ù† Ø¹Ø§Ù… ÙˆØ¢Ù…Ù†ØŒ ÙˆØªØ¬Ù†Ù‘Ø¨ Ø§Ù„Ø£Ù…Ø§ÙƒÙ† Ø§Ù„Ù…Ø¹Ø²ÙˆÙ„Ø©.</p>
                </div>
                <div class="bg-gray-50 border border-gray-200 rounded-2xl p-3 flex gap-3 items-start">
                  <span class="text-lg">ğŸ’³</span>
                  <p>Ù„Ø§ ØªÙ‚Ù… Ø¨Ø£ÙŠ ØªØ­ÙˆÙŠÙ„Ø§Øª Ù…Ø§Ù„ÙŠØ© Ù‚Ø¨Ù„ Ø§Ù„Ø§ØªÙØ§Ù‚ Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ.</p>
                </div>
                <div class="bg-gray-50 border border-gray-200 rounded-2xl p-3 flex gap-3 items-start">
                  <span class="text-lg">ğŸ”’</span>
                  <p>Ù…Ù†ØµØ© Ø±ÙƒÙ† Ù‡ÙŠ ÙˆØ³ÙŠØ· Ø¥Ø¹Ù„Ø§Ù†ÙŠ ÙˆÙ„Ø§ ØªØªØ¯Ø®Ù„ ÙÙŠ Ø§Ù„Ø§ØªÙØ§Ù‚Ø§Øª.</p>
                </div>
              </div>
            </div>
          </div>

          <!-- Similar Requests -->
          <section class="container-box p-5 sm:p-6">
            <div class="relative z-10">
              <div class="flex flex-col sm:flex-row items-center justify-between gap-3 mb-6">
                <h2 class="text-lg md:text-xl font-extrabold text-gray-900">Ø·Ù„Ø¨Ø§Øª Ù…Ø´Ø§Ø¨Ù‡Ø© ÙÙŠ Ù†ÙØ³ Ø§Ù„Ù‚Ø³Ù…</h2>
              </div>

              <div id="requestsGrid" class="grid grid-cols-1 md:grid-cols-2 gap-4 mt-3">
                {% for r in similar_requests|slice:":8" %}
                  {% include "partials/_request_card.html" with request=r %}
                {% empty %}
                  <p class="text-center text-gray-500 py-6 col-span-full">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø·Ù„Ø¨Ø§Øª Ù…Ø´Ø§Ø¨Ù‡Ø© Ø­Ø§Ù„ÙŠØ§Ù‹.</p>
                {% endfor %}
              </div>

              {% if similar_requests|length > 8 %}
                <div class="mt-8 flex justify-center">
                  <button id="loadMoreBtn"
                          class="px-6 py-2.5 rounded-full bg-[var(--rukn-green)] text-white text-sm sm:text-base font-semibold shadow hover:opacity-95 active:opacity-90 transition">
                    ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ø²ÙŠØ¯ Ù…Ù† Ø§Ù„Ø·Ù„Ø¨Ø§Øª
                  </button>
                </div>
                {{ similar_requests|slice:"8:"|json_script:"more-requests-data" }}
              {% endif %}
            </div>
          </section>

        </section>

        <!-- Left 30% -->
        <aside class="w-full lg:w-[30%] lg:order-2 space-y-5 lg:ps-2 mt-6 sm:mt-0">
          <div class="space-y-5 lg:sticky lg:top-4">
            <section class="container-box">
              <div class="relative z-10">

                {% with u=request_obj.listing.user %}
                <div class="relative group cursor-pointer mt-1 p-5 sm:p-6 border-b-2 border-gray-200"
                     onclick="window.location.href='{% url 'user_profile' u.user_id %}'">
                  <div class="absolute inset-0 group-hover:bg-green-100/70 transition-all duration-200"></div>

                  <div class="relative flex items-center justify-start gap-4 px-2 pb-2">
                    {% if u.photo %}
                      <img src="{{ u.photo.url }}"
                           class="w-16 h-16 rounded-full border-2 border-green-300 shadow-sm flex-shrink-0 object-cover"
                           alt="requester avatar">
                    {% else %}
                      <div class="w-16 h-16 rounded-full border-2 border-green-300 shadow-sm flex-shrink-0
                                  bg-gray-200 flex items-center justify-center text-xl font-extrabold text-gray-700">
                        {{ u.first_name|default:u.username|default:"Ù…"|first|upper }}
                      </div>
                    {% endif %}

                    <div class="flex flex-col items-start text-right">
                      <div class="flex items-center gap-2 justify-end">
                        <h4 class="text-sm font-extrabold text-gray-900 leading-tight">
                          {{ u.first_name }} {{ u.last_name }}
                        </h4>
                      </div>
                    </div>
                  </div>

                  <div class="flex gap-2 mt-4 text-[11px] text-gray-700 justify-start px-2">
                      <span class="meta-pill">
                          <span class="meta-icon text-green-600">
                              <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m19 21-7-4-7 4V5a2 2 0 0 1 2-2h10a2 2 0 0 1 2 2Z" /><path d="m9 10 2 2 4-4" /></svg>
                          </span>{{ requester_requests_count|default:0 }} Ø·Ù„Ø¨
                      </span>
                      <span class="meta-pill">
                          <span class="meta-icon text-green-600">
                              <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M5 22h14" /><path d="M5 2h14" /><path d="M17 22v-4.172a2 2 0 0 0-.586-1.414L12 12l-4.414 4.414A2 2 0 0 0 7 17.828V22" /><path d="M7 2v4.172a2 2 0 0 0 .586 1.414L12 12l4.414-4.414A2 2 0 0 0 17 6.172V2" /></svg>
                          </span>
                          Ø¹Ø¶Ùˆ Ù…Ù†Ø° {{ u.date_joined|timesince }}
                      </span>
                  </div>
                </div>
                {% endwith %}

                <!-- Quick actions -->
                <div class="border-t-2 border-[var(--rukn-gray)] p-5 sm:p-6 border-b-2 border-gray-200">
                  <div class="flex items-center justify-between mb-3">
                    <h3 class="text-xs sm:text-sm font-bold text-gray-800 flex items-center gap-2">
                      <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16"
                           viewBox="0 0 24 24" fill="none" stroke="currentColor"
                           stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <rect width="18" height="18" x="3" y="3" rx="2" />
                        <path d="M21 9H3" />
                        <path d="M21 15H3" />
                      </svg>
                      <span>Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª Ø³Ø±ÙŠØ¹Ø©</span>
                    </h3>
                  </div>

                  <div class="rounded-2xl bg-[var(--rukn-gray)] px-2 py-2">
                    <div class="grid grid-cols-2 gap-1.5 sm:gap-2">

                      <button id="shareBtn" type="button"
                              class="group flex flex-col items-center justify-center gap-1 rounded-2xl px-3 py-2
                                     bg-white border border-gray-200
                                     hover:border-sky-300 hover:bg-sky-50 hover:shadow-sm
                                     text-[11px] sm:text-xs font-semibold text-gray-700 transition">
                        <span class="flex items-center justify-center w-9 h-9 sm:w-10 sm:h-10 rounded-full
                                     bg-gray-50 border border-gray-200 text-gray-400
                                     group-hover:bg-sky-100 group-hover:border-sky-300 group-hover:text-sky-600 transition">
                          <svg xmlns="http://www.w3.org/2000/svg" class="w-4 h-4 sm:w-5 sm:h-5"
                               viewBox="0 0 24 24" fill="none" stroke="currentColor"
                               stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <circle cx="18" cy="5" r="3" />
                            <circle cx="6" cy="12" r="3" />
                            <circle cx="18" cy="19" r="3" />
                            <path d="M8.5 11l7-4" />
                            <path d="M8.5 13l7 4" />
                          </svg>
                        </span>
                        <span class="leading-tight text-center group-hover:text-sky-700 transition">Ù…Ø´Ø§Ø±ÙƒØ©</span>
                      </button>

                      <button id="openReportModalBtn" type="button"
                              data-auth="{% if request.user.is_authenticated %}1{% else %}0{% endif %}"
                              data-login-modal="loginModal"
                              class="group flex flex-col items-center justify-center gap-1 rounded-2xl px-3 py-2
                                     bg-white border border-gray-200
                                     hover:border-rose-300 hover:bg-rose-50 hover:shadow-sm
                                     text-[11px] sm:text-xs font-semibold text-gray-700 transition">
                        <span class="flex items-center justify-center w-9 h-9 sm:w-10 sm:h-10 rounded-full
                                     bg-gray-50 border border-gray-200 text-gray-400
                                     group-hover:bg-rose-100 group-hover:border-rose-300 group-hover:text-rose-600 transition">
                          <svg xmlns="http://www.w3.org/2000/svg" class="w-4 h-4 sm:w-5 sm:h-5"
                               viewBox="0 0 24 24" fill="none" stroke="currentColor"
                               stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M10.3 3.3 2.4 18a1.7 1.7 0 0 0 1.5 2.5h16.2a1.7 1.7 0 0 0 1.5-2.5L13.7 3.3a1.7 1.7 0 0 0-3.4 0Z" />
                            <path d="M12 9v5" />
                            <path d="M12 17h.01" />
                          </svg>
                        </span>
                        <span class="leading-tight text-center group-hover:text-rose-700 transition">Ø¥Ø¨Ù„Ø§Øº</span>
                      </button>

                    </div>
                  </div>
                </div>

                <!-- Contact Info -->
                <div class="border-t-2 border-[var(--rukn-gray)] p-5 sm:p-6 space-y-4">
                  <div class="flex items-center justify-between">
                    <h3 class="text-xs sm:text-sm font-bold text-gray-800 flex items-center gap-2">
                      <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16"
                           viewBox="0 0 24 24" fill="none" stroke="currentColor"
                           stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M18 21a6 6 0 0 0-12 0" />
                        <circle cx="12" cy="11" r="4" />
                        <rect width="18" height="18" x="3" y="3" rx="2" />
                      </svg>
                      <span>Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ØªÙˆØ§ØµÙ„</span>
                    </h3>
                  </div>

                  <div class="space-y-2 text-[11px] sm:text-xs">
                    <span class="text-gray-500">Ø±Ù‚Ù… Ø§Ù„Ù…ÙˆØ¨Ø§ÙŠÙ„ (Ø§Ø¶ØºØ· Ø¹Ù„Ù‰ Ø§Ù„Ø±Ù‚Ù… Ù„Ø¥Ø¸Ù‡Ø§Ø±Ù‡ Ø¨Ø§Ù„ÙƒØ§Ù…Ù„)</span>

                    <div class="flex items-center justify-start gap-5">
                      <button type="button"
                              id="revealPhoneBtn"
                              class="flex text-right text-lg font-extrabold text-gray-900 underline-offset-2 hover:text-[var(--rukn-green)] hover:underline transition">
                        <span id="sellerPhone"
                                    dir="ltr"
                            data-masked="{{ requester_phone_masked|default:'07â€¢â€¢ â€¢â€¢â€¢ â€¢â€¢â€¢' }}"
                            data-full="{{ request_obj.listing.user.phone|default:'' }}"
                            data-revealed="false"
                            data-allow="{% if allow_show_phone %}1{% else %}0{% endif %}">
                        {{ requester_phone_masked|default:"07â€¢â€¢ â€¢â€¢â€¢ â€¢â€¢â€¢" }}
                      </span>
                      </button>

                      <div id="contactActions" class="hidden flex items-center justify-start gap-2">
                        <a id="callBtn" href="#"
                           class="w-8 h-8 sm:w-9 sm:h-9 rounded-full bg-gray-50 border border-gray-200
                                  flex items-center justify-center text-gray-400
                                  hover:bg-green-50 hover:border-green-300 hover:text-emerald-700 transition"
                           aria-label="Call">
                          <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18"
                               viewBox="0 0 24 24" fill="none" stroke="currentColor"
                               stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.05 12.05 0 0 0 .57 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.05 12.05 0 0 0 2.81.57A2 2 0 0 1 22 16.92z"/>
                          </svg>
                        </a>

                        <a id="whatsappBtn" href="#" target="_blank" rel="noopener"
                           class="w-8 h-8 sm:w-9 sm:h-9 rounded-full bg-gray-50 border border-gray-200
                                  flex items-center justify-center text-gray-400
                                  hover:bg-emerald-50 hover:border-emerald-300 hover:text-emerald-700 transition"
                           aria-label="WhatsApp">
                          <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18"
                               viewBox="0 0 24 24" fill="currentColor">
                            <path d="M20.52 3.48A11.94 11.94 0 0 0 12.06 0C5.45 0 .07 5.38.07 12c0 2.11.55 4.17 1.6 6L0 24l6.2-1.63A11.93 11.93 0 0 0 12.06 24C18.67 24 24.05 18.62 24.05 12c0-3.2-1.25-6.21-3.53-8.52z"/>
                          </svg>
                        </a>
                      </div>
                    </div>
                  </div>

                  <!-- Message -->
                  <div class="mt-2">
                    <button id="toggleMessageBox"
                            type="button"
                            data-auth="{% if request.user.is_authenticated %}1{% else %}0{% endif %}"
                            data-login-modal="loginModal"
                            class="w-full flex items-center justify-between gap-2 px-4 py-2.5 rounded-2xl
                                   bg-white border border-green-200 text-[var(--rukn-green)]
                                   text-xs sm:text-sm font-semibold
                                   shadow-sm hover:bg-green-50/60 transition">
                      <span class="flex items-center gap-2">
                        <svg class="w-4 h-4" viewBox="0 0 20 20" fill="none">
                          <path d="M4 4h12v8H9.5L6 15v-3H4z"
                                stroke="currentColor" stroke-width="1.4"
                                stroke-linecap="round" stroke-linejoin="round" />
                        </svg>
                        <span>ØªÙˆØ§ØµÙ„ Ù…Ø¹ Ù…Ù‚Ø¯Ù… Ø§Ù„Ø·Ù„Ø¨</span>
                      </span>
                      <svg id="messageChevron" class="w-4 h-4 text-[var(--rukn-green)] transition-transform" viewBox="0 0 20 20" fill="none">
                        <path d="M6 8l4 4 4-4" stroke="currentColor" stroke-width="1.5"
                              stroke-linecap="round" stroke-linejoin="round" />
                      </svg>
                    </button>

                    <div id="messageBox" class="mt-3 hidden rounded-2xl border border-gray-200 bg-white p-3 sm:p-4">
                      <form id="messageForm"
                            class="space-y-2 text-right"
                            method="post"
                            action="{% url 'start_conversation_request' request_obj.id %}">
                        {% csrf_token %}
                        <p class="text-[11px] sm:text-[12px] text-[var(--muted)] mb-1">
                          Ù„Ø¯ÙŠÙƒ Ø´ÙŠØ¡ Ù…Ø´Ø§Ø¨Ù‡ØŸ ØªÙˆØ§ØµÙ„ Ù…Ø¹ Ù…Ù‚Ø¯Ù… Ø§Ù„Ø·Ù„Ø¨.
                        </p>

                        <textarea id="messageText" name="body" rows="4"
                                  placeholder="Ù„Ø§ ØªØ´Ø§Ø±Ùƒ ÙƒÙ„Ù…Ø§Øª Ø§Ù„Ù…Ø±ÙˆØ± Ø£Ùˆ Ø£Ø±Ù‚Ø§Ù… Ø§Ù„Ø­Ø³Ø§Ø¨Ø§Øª Ø§Ù„Ø¨Ù†ÙƒÙŠØ© Ø£Ùˆ Ø£ÙŠ Ø¨ÙŠØ§Ù†Ø§Øª Ø´Ø®ØµÙŠØ© Ø­Ø³Ø§Ø³Ø©"
                                  class="w-full border border-gray-200 rounded-2xl py-2.5 px-3 text-xs focus:outline-none focus:border-[var(--rukn-green)]"></textarea>

                        <p id="messageError" class="text-red-600 text-xs font-bold hidden">
                          âš ï¸ Ø§ÙƒØªØ¨ Ø±Ø³Ø§Ù„ØªÙƒ Ø£ÙˆÙ„Ø§Ù‹ Ù„ÙŠØªÙ… Ø¥Ø±Ø³Ø§Ù„Ù‡Ø§
                        </p>

                        <button type="submit"
                                class="px-6 py-2.5 bg-[var(--rukn-green)] text-white font-semibold rounded-2xl text-sm hover:opacity-95 shadow-sm w-full sm:w-auto">
                          Ø¥Ø±Ø³Ø§Ù„
                        </button>
                      </form>
                    </div>
                  </div>

                </div>

              </div>
            </section>
          </div>
        </aside>

      </div>
    </main>

    <!-- Toast Alert -->
    <div id="ruknAlert" class="fixed inset-0 flex items-center justify-center pointer-events-none opacity-0 transition-all duration-300 z-[9999]">
      <div id="ruknAlertBox" class="bg-[var(--rukn-green)] text-white px-6 py-3 rounded-2xl shadow-2xl text-sm sm:text-base font-bold transform scale-75 transition-all duration-300">
        âœ” ØªÙ… Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡
      </div>
    </div>

    {% include "partials/_report_modal_mockup.html" with report_kind="request" %}

  </div>
</div>

{% endblock %}

{% block scripts %}
  {{ block.super }}
  <script src="{% static 'js/report-modal.js' %}" defer></script>
  <script src="{% static 'js/message-box.js' %}" defer></script>
  <script src="{% static 'js/view-request.js' %}" defer></script>
{% endblock %}
