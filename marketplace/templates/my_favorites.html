{% extends 'base.html' %}
{% load i18n %}

{% block title %}{% trans "My Favorites" %}{% endblock %}

{% block content %}
<h2>{% trans "My Favorites" %}</h2>

{% if page_obj.object_list %}
  <div style="display:grid; gap:16px;">
    {% for fav in page_obj.object_list %}
      {% with item=fav.item %}
      <div style="display:flex; gap:12px; align-items:flex-start; border:1px solid #e5e5e5; padding:10px; border-radius:8px;">
        {% with first_photo=item.photos.first %}
          {% if first_photo %}
            <img src="{{ first_photo.image.url }}" alt="{{ item.title }}" width="100" height="100" style="object-fit:cover;border-radius:6px;">
          {% endif %}
        {% endwith %}

        <div style="flex:1;">
          <h3 style="margin:0 0 6px;">
            <a href="{% url 'item_detail' item.id %}">{{ item.title }}</a>
          </h3>

          <div style="font-size:14px; color:#555;">
            {% trans "Price" %}: {{ item.price }} |
            {% trans "Posted" %}: {{ item.created_at|date:"Y-m-d H:i" }}
            {% if item.updated_at %}| {% trans "Updated" %}: {{ item.updated_at|date:"Y-m-d H:i" }}{% endif %}
          </div>

          <div style="margin-top:10px; display:flex; gap:10px; align-items:center;">
            <form method="post" action="{% url 'toggle_favorite' item.id %}">
              {% csrf_token %}
              <input type="hidden" name="next" value="{% url 'my_favorites' %}">
              <button type="submit" style="border:1px solid #bbb; padding:4px 10px; border-radius:6px; cursor:pointer;">
                ✳️ {% trans "Remove from Favorites" %}
              </button>
            </form>
          </div>
        </div>
      </div>
      {% endwith %}
    {% endfor %}
  </div>

  <!-- Pagination -->
  <div style="margin-top:16px; display:flex; gap:8px; align-items:center;">
    {% if page_obj.has_previous %}
      <a href="?page={{ page_obj.previous_page_number }}">&laquo; {% trans "Prev" %}</a>
    {% endif %}
    <span>{% trans "Page" %} {{ page_obj.number }} {% trans "of" %} {{ page_obj.paginator.num_pages }}</span>
    {% if page_obj.has_next %}
      <a href="?page={{ page_obj.next_page_number }}">{% trans "Next" %} &raquo;</a>
    {% endif %}
  </div>

{% else %}
  <p>{% trans "You don't have any favorites yet." %}</p>
{% endif %}

{% endblock %}
